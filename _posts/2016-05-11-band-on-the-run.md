---
layout: single
title: Band on the Run
date: 2016-05-11 11:53
author_profile: true
comments: true
categories: [Azure, botr, c#, MS Band, msband, MVVM, UWP, uwp, windows, xamarin]
header:
    teaserlogo: 'assets/images/'
    teaser: 'assets/images/'
---
<p>I promised earlier (<a title="http://peted.azurewebsites.net/fake-microsoft-band/" href="http://peted.azurewebsites.net/fake-microsoft-band/">http://peted.azurewebsites.net/fake-microsoft-band/</a>) to share some more details about the client-side of the <a href="https://github.com/BandOnTheRun/ms-band-azure" target="_blank">Band on the Run</a> project I have been working on alongside my colleague at Microsoft <a href="https://blogs.msdn.microsoft.com/david_gristwood/" target="_blank">David Gristwood</a>.We set the project up initially as a learning opportunity so we could better understand IOT (Internet of things) cloud architecture with a working system which was general enough to allow us to modify it to encompass different scenarios as our requirements shifted. To give a bit of background I have historically been more involved in client-side user interface technologies whereas David is more on the cloud architecture side. This project enabled us to develop our existing skills and also to learn and see the technology from the others’ perspective which I have found to be of very high value. Before I take a look at the client in more detail here are some other ways that the project has been used:</p> <blockquote> <p>Used as a basis of four internal hackathons at Microsoft (Dev Ops, Office 365, Azure and Universal Windows Platform)</p></blockquote> <blockquote> <p>Used as the core part of a presentation that David and I have delivered at various different events including Future Decoded UK and upcoming events e.g. The Wearable Technology Show and DevWeek</p></blockquote> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2016/05/wearabletech.png"><img title="wearabletech" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="wearabletech" src="http://peted.azurewebsites.net/wp-content/uploads/2016/05/wearabletech_thumb.png" width="735" height="196"></a>&nbsp;</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2016/05/WP_20160420_12_34_07_Rich_LI.jpg"><img title="WP_20160420_12_34_07_Rich_LI" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="WP_20160420_12_34_07_Rich_LI" src="http://peted.azurewebsites.net/wp-content/uploads/2016/05/WP_20160420_12_34_07_Rich_LI_thumb.jpg" width="730" height="412"></a></p> <blockquote> <p>Used as a demo at <a href="http://reasons.to/" target="_blank">Reasons to be Creative</a> event by another colleague <a href="http://andrewspooner.com/blog/" target="_blank">Andrew Spooner</a></p></blockquote> <p>We have also had a lot of interest internally at Microsoft but we haven’t quite done the work to document and wrap the project up as a demo-in-a-box which is in our backlog.</p> <p>We recently migrated the back-end from Azure Event Hub to Azure IOT Hub – details at David’s blog here <a title="https://blogs.msdn.microsoft.com/david_gristwood/2016/02/26/moving-to-azure-iot-hub/" href="https://blogs.msdn.microsoft.com/david_gristwood/2016/02/26/moving-to-azure-iot-hub/">Moving to Azure IOT Hub</a></p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2016/05/skipjpg.jpg"><img title="skipjpg" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="skipjpg" src="http://peted.azurewebsites.net/wp-content/uploads/2016/05/skipjpg_thumb.jpg" width="261" height="461"></a></p> <p>limbering up for DevWeek</p> <h2>The Client App</h2> <p>The client app started life as a Windows 8.1 Universal App which ran on Windows 8.1 desktops/tablets and phones and worked with one Band and just displayed a heart rate value on it’s UI and sent the data to Azure Event Hubs using an HTTP POST. Since then it has been updated to a Windows Universal Platform (UWP) app and as a result consists of one project which targets all UWP platforms. I did a bit of research early on about how to start the project in terms of starting with a project template and decided on using <a href="https://github.com/Windows-XAML/Template10" target="_blank">Template 10</a> as I wanted to experiment with the hamburger menu inside an app. I always use an MVVM architecture within my windows apps and template 10 allows integration of MVVM components of your choosing. Here are some components I brought in to the project to help with this:</p> <blockquote> <p><a href="http://autofac.org/" target="_blank">Autofac</a> for dependency injection</p> <p><a href="http://caliburnmicro.com/documentation/event-aggregator" target="_blank">Caliburn.Micro.EventAggregator</a> – for messaging between View Models</p> <p>AsyncDelegateCommand / DelegateCommand – for commanding</p></blockquote> <p>To be honest, I quite like bringing in separate components to build up the pieces required for MVVM&nbsp;&nbsp; </p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2016/05/appcapture.png"><img title="appcapture" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="appcapture" src="http://peted.azurewebsites.net/wp-content/uploads/2016/05/appcapture_thumb.png" width="725" height="448"></a></p> <h3>Responsive User Interface</h3> <p>The requirements were fairly non-standard for this app since we wanted to optimise for large screens by displaying all relevant information about the band data on one screen (for presentation purposes) but we also wanted the app to work on smaller displays and phones. Adaptive triggers were used along with the VisualStateManager to set the UI into a particular state depending on which adaptive trigger was currently active. For web developers this is a similar concept to media queries and you can create your own custom adaptive triggers but I chose to use the in-the-box triggers which activate states based on the current width of the window. I used three different visual states:</p> <p>Narrow, Normal and Wide</p> <p>The narrow and normal states used two pages one for a list of bands and the second for band data details and the user could navigate between the list and the details view but the wide state consists of only the main page which tiles two columns of band tiles which stretch to fill up the space and get as much data onto the display as possible. The narrow state works well on a mobile phone as well.</p> <h3>Real-time Sensor Data</h3> <p>My previous post <a title="http://peted.azurewebsites.net/microsoft-band-heart-rate-sample-uwp/" href="http://peted.azurewebsites.net/microsoft-band-heart-rate-sample-uwp/">http://peted.azurewebsites.net/microsoft-band-heart-rate-sample-uwp/</a> shows the code for accessing heart rate data from a paired band in real-time and this code is fairly similar to that used in the Band on the Run client. In addition, since we want to send that data (also in real-time) up to the Azure IOT Hub then we can now use the Microsoft Azure Devices Client nuget package</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2016/05/devicesclient.png"><img title="devicesclient" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="devicesclient" src="http://peted.azurewebsites.net/wp-content/uploads/2016/05/devicesclient_thumb.png" width="738" height="475"></a></p> <p>I have introduced an ITelemetry interface which supports registering a particular device and also posting the data up to Azure. Previously we did this via Event Hub and creating shared access signatures for access. Since moving to IOT Hub the registration and sending are implemented in the Nuget package so I just created a new implementation of ITelemetry which wraps the library. Posting the data looks like this:</p><script src="https://gist.github.com/peted70/bb0d9361cb4cb9488e7ba95607f20bd9.js"></script> <h2>Fake Data</h2> <p>In order to keep developing in scenarios where the developer has no access to a physical band the project also uses the FakeBand nuget package (see <a title="http://peted.azurewebsites.net/fake-microsoft-band/" href="http://peted.azurewebsites.net/fake-microsoft-band/">http://peted.azurewebsites.net/fake-microsoft-band/</a>) and I’m just thinking about the best way to record and playback sensor data using this library.</p> <h2>Cross Platform</h2> <p>I am also converting the client app to be cross platform; so the intention is to use <a href="http://xamarin.com" target="_blank">Xamarin</a> to create a c# cross-platform app for iOS, Android and UWP and I have started this work in a branch on the Git repo. Note that the band SDK supports Xamarin already so I could share most of the codebase between the platforms and will most-likely create native UIs on each.</p> <p>We always welcome collaboration, contributions or suggestions – please use the Github repos for Band on the Run here <a title="https://github.com/BandOnTheRun" href="https://github.com/BandOnTheRun">https://github.com/BandOnTheRun</a></p>
