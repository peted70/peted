---
layout: single
title: Windows Phone 7, MVVM and TDD (Part 6 – loading screen)
date: 2010-05-06 23:11
author_profile: true
comments: true
categories: [MVVM, TDD, Windows Phone 7]
header:
    teaserlogo: 'assets/images/'
    teaser: 'assets/images/'
---
<div id="msgcns!4F1B7368284539E5!258" class="bvMsg"><p>By Peter Daukintis</p> <p>First we need to create the loading screen user control which is heavily based upon the one used here <a href="http://www.orktane.com/Blog/post/2010/01/23/iPhone-Sudoku-in-Silverlight-using-MVVM.aspx">http://www.orktane.com/Blog/post/2010/01/23/iPhone-Sudoku-in-Silverlight-using-MVVM.aspx</a>.</p> <p><a href="https://omlweq.bay.livefilestore.com/y1mqEOMzXZFPubidDDRnoyVNEX6PbRK34fA8tklNvGQLxFlw3ZXATtMnGuF2E8oY3YoLZCSts3F2PH-7KlIMRZRWIP1IkOpAyh-QsaSF55oeJnDv-e9Y3JRHVTgHNhO8IdLrqo6mhsaeIwuwHXcEz5opA/WP7LoginLoadingControl3.png" rel="WLPP"><img style="display:block;float:none;margin-left:auto;margin-right:auto;border-width:0;" title="WP7LoginLoadingControl" border="0" alt="WP7LoginLoadingControl" src="http://peted.azurewebsites.net/wp-content/uploads/2010/09/wp7loginloadingcontrol_thumb1.png?w=300" width="669" height="420" /></a></p> <p>It consists of a grid containing eight rectangles which have associated animations that cycle through different greyscales/transparencies. The code-behind shows that the user control implements the IBusyIndicator from  <a href="http://babaandthepigman.spaces.live.com/blog/cns!4F1B7368284539E5!244.entry">http://babaandthepigman.spaces.live.com/blog/cns!4F1B7368284539E5!244.entry</a>.</p><pre>    <span style="color:#eaeaac;">public partial class </span><span style="color:#f0dfaf;">BusyIndicator </span><span style="color:#d2d200;">: </span><span style="color:#f0dfaf;">UserControl</span><span style="color:#d2d200;">, </span><span style="color:#2b91af;">IBusyIndicator
    </span><span style="color:#d2d200;">&#123;
        </span><span style="color:#eaeaac;">private readonly </span><span style="color:#f0dfaf;">List</span><span style="color:#d2d200;">&lt;</span><span style="color:#eaeaac;">object</span><span style="color:#d2d200;">&gt; </span><span style="color:#f8ffc6;">_tokens</span><span style="color:#d2d200;">;

        </span><span style="color:#eaeaac;">public </span><span style="color:#f8ffc6;">BusyIndicator</span><span style="color:#d2d200;">()
        &#123;
            </span><span style="color:lime;">// Required to initialize variables
            </span><span style="color:#f8ffc6;">InitializeComponent</span><span style="color:#d2d200;">();
            </span><span style="color:#f8ffc6;">_tokens </span><span style="color:#d2d200;">= </span><span style="color:#eaeaac;">new </span><span style="color:#f0dfaf;">List</span><span style="color:#d2d200;">&lt;</span><span style="color:#eaeaac;">object</span><span style="color:#d2d200;">&gt;();
            </span><span style="color:#eaeaac;">if </span><span style="color:#d2d200;">(!</span><span style="color:#f8ffc6;">System</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">ComponentModel</span><span style="color:#d2d200;">.</span><span style="color:#f0dfaf;">DesignerProperties</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">GetIsInDesignMode</span><span style="color:#d2d200;">(</span><span style="color:#eaeaac;">this</span><span style="color:#d2d200;">))
                </span><span style="color:#f8ffc6;">LayoutRoot</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Visibility </span><span style="color:#d2d200;">= </span><span style="color:#2b91af;">Visibility</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Collapsed</span><span style="color:#d2d200;">;
        &#125;

        </span><span style="color:#dfaf8f;">#region </span><span style="color:#d2d200;">Implementation of IBusyIndicator

        </span><span style="color:#eaeaac;">public void </span><span style="color:#f8ffc6;">Hide</span><span style="color:#d2d200;">(</span><span style="color:#eaeaac;">object </span><span style="color:#f8ffc6;">token</span><span style="color:#d2d200;">)
        &#123;
            </span><span style="color:#f8ffc6;">_tokens</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Remove</span><span style="color:#d2d200;">(</span><span style="color:#f8ffc6;">token</span><span style="color:#d2d200;">);
            </span><span style="color:#eaeaac;">if </span><span style="color:#d2d200;">(</span><span style="color:#f8ffc6;">_tokens</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Count </span><span style="color:#d2d200;">== </span><span style="color:#8acccf;">0</span><span style="color:#d2d200;">)
            &#123;
                </span><span style="color:#f8ffc6;">LayoutRoot</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Visibility </span><span style="color:#d2d200;">= </span><span style="color:#2b91af;">Visibility</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Collapsed</span><span style="color:#d2d200;">;
                </span><span style="color:#f8ffc6;">CycleStoryboard</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Stop</span><span style="color:#d2d200;">();
            &#125;
        &#125;

        </span><span style="color:#eaeaac;">public void </span><span style="color:#f8ffc6;">Show</span><span style="color:#d2d200;">(</span><span style="color:#eaeaac;">object </span><span style="color:#f8ffc6;">token</span><span style="color:#d2d200;">)
        &#123;
            </span><span style="color:#f8ffc6;">_tokens</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Add</span><span style="color:#d2d200;">(</span><span style="color:#f8ffc6;">token</span><span style="color:#d2d200;">);
            </span><span style="color:#eaeaac;">if </span><span style="color:#d2d200;">(</span><span style="color:#f8ffc6;">LayoutRoot</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Visibility </span><span style="color:#d2d200;">!= </span><span style="color:#2b91af;">Visibility</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Visible</span><span style="color:#d2d200;">)
            &#123;
                </span><span style="color:#f8ffc6;">LayoutRoot</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Visibility </span><span style="color:#d2d200;">= </span><span style="color:#2b91af;">Visibility</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Visible</span><span style="color:#d2d200;">;
                </span><span style="color:#f8ffc6;">CycleStoryboard</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">Begin</span><span style="color:#d2d200;">();
            &#125;
        &#125;

        </span><span style="color:#dfaf8f;">#endregion
    </span><span style="color:#d2d200;">&#125;
</span></pre><a href="http://11011.net/software/vspaste"></a>
<p> </p>
<p>Also, I will add one to the visual tree </p><pre>            <span style="color:#d2d200;">&lt;myControls:BusyIndicator x:Name=</span><span style="color:white;">&quot;BusyIndicator&quot; </span><span style="color:#d2d200;">d:IsHidden=</span><span style="color:white;">&quot;True&quot;</span><span style="color:#d2d200;">/&gt;

</span></pre>
<p>and in the MainPage code behind I will register the control with the service locator so the service can be made available:</p><pre>            <span style="color:#f0dfaf;">ServiceLocator</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">SetBusyIndicatorService</span><span style="color:#d2d200;">(</span><span style="color:#f8ffc6;">BusyIndicator</span><span style="color:#d2d200;">);

</span></pre>
<p>This should enable the loading screen…but wait, somehow I’ve got this far without actually creating a UserRepository – so here goes…</p><pre>    <span style="color:#eaeaac;">public class </span><span style="color:#f0dfaf;">UserRepository </span><span style="color:#d2d200;">: </span><span style="color:#2b91af;">IUserRepository
    </span><span style="color:#d2d200;">&#123;
        </span><span style="color:#eaeaac;">public bool </span><span style="color:#f8ffc6;">Login</span><span style="color:#d2d200;">(</span><span style="color:#eaeaac;">string </span><span style="color:#f8ffc6;">username</span><span style="color:#d2d200;">, </span><span style="color:#eaeaac;">string </span><span style="color:#f8ffc6;">password</span><span style="color:#d2d200;">)
        &#123;
            </span><span style="color:#f0dfaf;">Thread</span><span style="color:#d2d200;">.</span><span style="color:#f8ffc6;">SpinWait</span><span style="color:#d2d200;">(</span><span style="color:#8acccf;">100000</span><span style="color:#d2d200;">);
            </span><span style="color:#eaeaac;">return </span><span style="color:#d2d200;">(</span><span style="color:#f8ffc6;">username </span><span style="color:#d2d200;">== </span><span style="color:#c89191;">&quot;fred&quot; </span><span style="color:#d2d200;">&amp;&amp; </span><span style="color:#f8ffc6;">password </span><span style="color:#d2d200;">== </span><span style="color:#c89191;">&quot;fred&quot;</span><span style="color:#d2d200;">);
        &#125;
    &#125;

</span></pre>
<p>and, in the MVVM Light supplied ViewModelLocator (which constructs our MainViewModel), we can pass a new UserRepository into the constructor..</p><pre>        <span style="color:#eaeaac;">public static void </span><span style="color:#f8ffc6;">CreateMain</span><span style="color:#d2d200;">()
        &#123;
            </span><span style="color:#eaeaac;">if </span><span style="color:#d2d200;">(</span><span style="color:#f8ffc6;">_main </span><span style="color:#d2d200;">== </span><span style="color:#eaeaac;">null</span><span style="color:#d2d200;">)
            &#123;
                </span><span style="color:#f8ffc6;">_main </span><span style="color:#d2d200;">= </span><span style="color:#eaeaac;">new </span><span style="color:#f0dfaf;">MainViewModel</span><span style="color:#d2d200;">(</span><span style="color:#eaeaac;">new </span><span style="color:#f0dfaf;">UserRepository</span><span style="color:#d2d200;">());
            &#125;
        &#125;

</span></pre>And that’s it for the loading screen!
<p></p>Technorati Tags: <a href="http://technorati.com/tags/MVVM" rel="tag">MVVM</a>,<a href="http://technorati.com/tags/Part" rel="tag">Part</a>,<a href="http://technorati.com/tags/Peter" rel="tag">Peter</a>,<a href="http://technorati.com/tags/Daukintis" rel="tag">Daukintis</a>,<a href="http://technorati.com/tags/user" rel="tag">user</a>,<a href="http://technorati.com/tags/Blog" rel="tag">Blog</a>,<a href="http://technorati.com/tags/Sudoku" rel="tag">Sudoku</a>,<a href="http://technorati.com/tags/grid" rel="tag">grid</a>,<a href="http://technorati.com/tags/cycle" rel="tag">cycle</a>,<a href="http://technorati.com/tags/code" rel="tag">code</a>,<a href="http://technorati.com/tags/implements" rel="tag">implements</a>,<a href="http://technorati.com/tags/IBusyIndicator" rel="tag">IBusyIndicator</a>,<a href="http://technorati.com/tags/BusyIndicator" rel="tag">BusyIndicator</a>,<a href="http://technorati.com/tags/UserControl" rel="tag">UserControl</a>,<a href="http://technorati.com/tags/List" rel="tag">List</a>,<a href="http://technorati.com/tags/InitializeComponent" rel="tag">InitializeComponent</a>,<a href="http://technorati.com/tags/System" rel="tag">System</a>,<a href="http://technorati.com/tags/ComponentModel" rel="tag">ComponentModel</a>,<a href="http://technorati.com/tags/DesignerProperties" rel="tag">DesignerProperties</a>,<a href="http://technorati.com/tags/GetIsInDesignMode" rel="tag">GetIsInDesignMode</a>,<a href="http://technorati.com/tags/LayoutRoot" rel="tag">LayoutRoot</a>,<a href="http://technorati.com/tags/region" rel="tag">region</a>,<a href="http://technorati.com/tags/Implementation" rel="tag">Implementation</a>,<a href="http://technorati.com/tags/Hide" rel="tag">Hide</a>,<a href="http://technorati.com/tags/Remove" rel="tag">Remove</a>,<a href="http://technorati.com/tags/Count" rel="tag">Count</a>,<a href="http://technorati.com/tags/CycleStoryboard" rel="tag">CycleStoryboard</a>,<a href="http://technorati.com/tags/Stop" rel="tag">Stop</a>,<a href="http://technorati.com/tags/Visible" rel="tag">Visible</a>,<a href="http://technorati.com/tags/Begin" rel="tag">Begin</a>,<a href="http://technorati.com/tags/Also" rel="tag">Also</a>,<a href="http://technorati.com/tags/tree" rel="tag">tree</a>,<a href="http://technorati.com/tags/Name" rel="tag">Name</a>,<a href="http://technorati.com/tags/IsHidden" rel="tag">IsHidden</a>,<a href="http://technorati.com/tags/True" rel="tag">True</a>,<a href="http://technorati.com/tags/MainPage" rel="tag">MainPage</a>,<a href="http://technorati.com/tags/ServiceLocator" rel="tag">ServiceLocator</a>,<a href="http://technorati.com/tags/SetBusyIndicatorService" rel="tag">SetBusyIndicatorService</a>,<a href="http://technorati.com/tags/UserRepository" rel="tag">UserRepository</a>,<a href="http://technorati.com/tags/IUserRepository" rel="tag">IUserRepository</a>,<a href="http://technorati.com/tags/Login" rel="tag">Login</a>,<a href="http://technorati.com/tags/password" rel="tag">password</a>,<a href="http://technorati.com/tags/Thread" rel="tag">Thread</a>,<a href="http://technorati.com/tags/SpinWait" rel="tag">SpinWait</a>,<a href="http://technorati.com/tags/ViewModelLocator" rel="tag">ViewModelLocator</a>,<a href="http://technorati.com/tags/MainViewModel" rel="tag">MainViewModel</a>,<a href="http://technorati.com/tags/CreateMain" rel="tag">CreateMain</a>,<a href="http://technorati.com/tags/_main" rel="tag">_main</a>,<a href="http://technorati.com/tags/animations" rel="tag">animations</a>,<a href="http://technorati.com/tags/username" rel="tag">username</a><br />
<p></p>Windows Live Tags: <a href="http://windows.live.com/connect/tag/MVVM" rel="clubhouseTag">MVVM</a>,<a href="http://windows.live.com/connect/tag/Part" rel="clubhouseTag">Part</a>,<a href="http://windows.live.com/connect/tag/Peter" rel="clubhouseTag">Peter</a>,<a href="http://windows.live.com/connect/tag/Daukintis" rel="clubhouseTag">Daukintis</a>,<a href="http://windows.live.com/connect/tag/user" rel="clubhouseTag">user</a>,<a href="http://windows.live.com/connect/tag/Blog" rel="clubhouseTag">Blog</a>,<a href="http://windows.live.com/connect/tag/Sudoku" rel="clubhouseTag">Sudoku</a>,<a href="http://windows.live.com/connect/tag/grid" rel="clubhouseTag">grid</a>,<a href="http://windows.live.com/connect/tag/cycle" rel="clubhouseTag">cycle</a>,<a href="http://windows.live.com/connect/tag/code" rel="clubhouseTag">code</a>,<a href="http://windows.live.com/connect/tag/implements" rel="clubhouseTag">implements</a>,<a href="http://windows.live.com/connect/tag/IBusyIndicator" rel="clubhouseTag">IBusyIndicator</a>,<a href="http://windows.live.com/connect/tag/BusyIndicator" rel="clubhouseTag">BusyIndicator</a>,<a href="http://windows.live.com/connect/tag/UserControl" rel="clubhouseTag">UserControl</a>,<a href="http://windows.live.com/connect/tag/List" rel="clubhouseTag">List</a>,<a href="http://windows.live.com/connect/tag/InitializeComponent" rel="clubhouseTag">InitializeComponent</a>,<a href="http://windows.live.com/connect/tag/System" rel="clubhouseTag">System</a>,<a href="http://windows.live.com/connect/tag/ComponentModel" rel="clubhouseTag">ComponentModel</a>,<a href="http://windows.live.com/connect/tag/DesignerProperties" rel="clubhouseTag">DesignerProperties</a>,<a href="http://windows.live.com/connect/tag/GetIsInDesignMode" rel="clubhouseTag">GetIsInDesignMode</a>,<a href="http://windows.live.com/connect/tag/LayoutRoot" rel="clubhouseTag">LayoutRoot</a>,<a href="http://windows.live.com/connect/tag/region" rel="clubhouseTag">region</a>,<a href="http://windows.live.com/connect/tag/Implementation" rel="clubhouseTag">Implementation</a>,<a href="http://windows.live.com/connect/tag/Hide" rel="clubhouseTag">Hide</a>,<a href="http://windows.live.com/connect/tag/Remove" rel="clubhouseTag">Remove</a>,<a href="http://windows.live.com/connect/tag/Count" rel="clubhouseTag">Count</a>,<a href="http://windows.live.com/connect/tag/CycleStoryboard" rel="clubhouseTag">CycleStoryboard</a>,<a href="http://windows.live.com/connect/tag/Stop" rel="clubhouseTag">Stop</a>,<a href="http://windows.live.com/connect/tag/Visible" rel="clubhouseTag">Visible</a>,<a href="http://windows.live.com/connect/tag/Begin" rel="clubhouseTag">Begin</a>,<a href="http://windows.live.com/connect/tag/Also" rel="clubhouseTag">Also</a>,<a href="http://windows.live.com/connect/tag/tree" rel="clubhouseTag">tree</a>,<a href="http://windows.live.com/connect/tag/Name" rel="clubhouseTag">Name</a>,<a href="http://windows.live.com/connect/tag/IsHidden" rel="clubhouseTag">IsHidden</a>,<a href="http://windows.live.com/connect/tag/True" rel="clubhouseTag">True</a>,<a href="http://windows.live.com/connect/tag/MainPage" rel="clubhouseTag">MainPage</a>,<a href="http://windows.live.com/connect/tag/ServiceLocator" rel="clubhouseTag">ServiceLocator</a>,<a href="http://windows.live.com/connect/tag/SetBusyIndicatorService" rel="clubhouseTag">SetBusyIndicatorService</a>,<a href="http://windows.live.com/connect/tag/UserRepository" rel="clubhouseTag">UserRepository</a>,<a href="http://windows.live.com/connect/tag/IUserRepository" rel="clubhouseTag">IUserRepository</a>,<a href="http://windows.live.com/connect/tag/Login" rel="clubhouseTag">Login</a>,<a href="http://windows.live.com/connect/tag/password" rel="clubhouseTag">password</a>,<a href="http://windows.live.com/connect/tag/Thread" rel="clubhouseTag">Thread</a>,<a href="http://windows.live.com/connect/tag/SpinWait" rel="clubhouseTag">SpinWait</a>,<a href="http://windows.live.com/connect/tag/ViewModelLocator" rel="clubhouseTag">ViewModelLocator</a>,<a href="http://windows.live.com/connect/tag/MainViewModel" rel="clubhouseTag">MainViewModel</a>,<a href="http://windows.live.com/connect/tag/CreateMain" rel="clubhouseTag">CreateMain</a>,<a href="http://windows.live.com/connect/tag/_main" rel="clubhouseTag">_main</a>,<a href="http://windows.live.com/connect/tag/animations" rel="clubhouseTag">animations</a>,<a href="http://windows.live.com/connect/tag/username" rel="clubhouseTag">username</a>  </div>
