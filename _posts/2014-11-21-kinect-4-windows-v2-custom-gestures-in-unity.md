---
layout: single
title: Kinect 4 Windows v2 &ndash; Custom Gestures in Unity
date: 2014-11-21 18:09
author: peted70
comments: true
categories: [Kinect, Unity, WinRT]
---
<p><a href="http://peted.azurewebsites.net/wp-content/uploads/2014/11/header.png"><img title="header" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" border="0" alt="header" src="http://peted.azurewebsites.net/wp-content/uploads/2014/11/header_thumb.png" width="965" height="628"></a> </p> <p>I have received a few questions recently about detecting Kinect custom gestures in Unity 3D and it seems that there are a few issues with getting this up and running. I have previously posted about <a href="http://peted.azurewebsites.net/visual-gesture-builder-kinect-4-windows-v2/">Kinect Custom Gestures</a> and also <a href="http://peted.azurewebsites.net/kinecting-xaml-unity/">using ‘built-in’ gestures</a> from the <a href="http://www.microsoft.com/en-us/download/details.aspx?id=44561">Kinect 4 Windows SDK</a> inside Unity so it makes sense to complete the loop here. I’ll run through my experience. A few things to set up straight off the bat:</p> <blockquote> <p>I created a new Unity project and selected to install the <a href="https://visualstudiogallery.msdn.microsoft.com/20b80b8c-659b-45ef-96c1-437828fe7cf2">Visual Studio 2013 Tools Unity Package</a> (not required but I like to debug using Visual Studio)</p> <p>I imported some Unity Kinect custom packages: <strong>Assets &gt; Import Package &gt; Custom Package</strong> and then navigated to the Kinect Unity Package location on my local disk. (the Kinect unity package can be downloaded here <a href="http://go.microsoft.com/fwlink/?LinkID=513177">http://go.microsoft.com/fwlink/?LinkID=513177</a>). Add both the Kinect and Kinect.VisualGestureBuilder packages.</p></blockquote> <h3>Creating the Scene</h3> <p>As before, in this <a href="http://peted.azurewebsites.net/kinect-4-windows-v2-unity-3d/">previous post</a> I created an empty game object and also a new c# script and added the following code to detect the Kinect sensor, pull the body data, exposing it to other scripts and also to retrieve the body tracking ID which will be required to identify the body on which we are detecting the gestures. To keep things simple I assumed only one tracked body and as always remember this is intended as a sample so I may not be as careful with cleaning up event handlers, etc.</p> <div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:3f7674fd-8ef4-40ec-9c94-d09099c8c28c" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"> <div class="le-pavsc-container"> <div style="background: #ddd; overflow: auto"> <ol start="1" style="background: #000000; margin: 0 0 0 2.5em; padding: 0 0 0 5px;"> <li><span style="background:#1e1e1e;color:#569cd6">public</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">class</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">BodySourceManager</span><span style="background:#1e1e1e;color:#dcdcdc"> : </span><span style="background:#1e1e1e;color:#4ec9b0">MonoBehaviour</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">private</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">KinectSensor</span><span style="background:#1e1e1e;color:#dcdcdc"> _Sensor;</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">private</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">BodyFrameReader</span><span style="background:#1e1e1e;color:#dcdcdc"> _Reader;</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">private</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Body</span><span style="background:#1e1e1e;color:#dcdcdc">[] _Data </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">private</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">ulong</span><span style="background:#1e1e1e;color:#dcdcdc"> _trackingId </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b5cea8">0</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">public</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">CustomGestureManager</span><span style="background:#1e1e1e;color:#dcdcdc"> GestureManager;</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">public</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Body</span><span style="background:#1e1e1e;color:#dcdcdc">[] GetData()</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">return</span><span style="background:#1e1e1e;color:#dcdcdc"> _Data;</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">&nbsp;</li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">void</span><span style="background:#1e1e1e;color:#dcdcdc"> Start()</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">_Sensor </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">KinectSensor</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">GetDefault();</span></li> <li class="le-pavsc-even">&nbsp;</li> <li>        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (_Sensor </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">_Reader </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> _Sensor</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">BodyFrameSource</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">OpenReader();</span></li> <li class="le-pavsc-even">&nbsp;</li> <li>            <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (</span><span style="background:#1e1e1e;color:#b4b4b4">!</span><span style="background:#1e1e1e;color:#dcdcdc">_Sensor</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">IsOpen)</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>                <span style="background:#1e1e1e;color:#dcdcdc">_Sensor</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Open();</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">void</span><span style="background:#1e1e1e;color:#dcdcdc"> Update()</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (_Reader </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">var</span><span style="background:#1e1e1e;color:#dcdcdc"> frame </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> _Reader</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">AcquireLatestFrame();</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (frame </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>                <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (_Data </span><span style="background:#1e1e1e;color:#b4b4b4">==</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>                    <span style="background:#1e1e1e;color:#dcdcdc">_Data </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">new</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Body</span><span style="background:#1e1e1e;color:#dcdcdc">[_Sensor</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">BodyFrameSource</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">BodyCount];</span></li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc">_trackingId </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b5cea8">0</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li>                <span style="background:#1e1e1e;color:#dcdcdc">frame</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">GetAndRefreshBodyData(_Data);</span></li> <li class="le-pavsc-even">&nbsp;</li> <li>                <span style="background:#1e1e1e;color:#dcdcdc">frame</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Dispose();</span></li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc">frame </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">foreach</span><span style="background:#1e1e1e;color:#dcdcdc"> (</span><span style="background:#1e1e1e;color:#569cd6">var</span><span style="background:#1e1e1e;color:#dcdcdc"> body </span><span style="background:#1e1e1e;color:#569cd6">in</span><span style="background:#1e1e1e;color:#dcdcdc"> _Data)</span></li> <li>                <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">                    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (body </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">&amp;&amp;</span><span style="background:#1e1e1e;color:#dcdcdc"> body</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">IsTracked)</span></li> <li>                    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">                        <span style="background:#1e1e1e;color:#dcdcdc">_trackingId </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> body</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">TrackingId;</span></li> <li>                        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (GestureManager </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li class="le-pavsc-even">                        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>                            <span style="background:#1e1e1e;color:#dcdcdc">GestureManager</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">SetTrackingId(body</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">TrackingId);</span></li> <li class="le-pavsc-even">                        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>                        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">break</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li class="le-pavsc-even">                    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>                <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">void</span><span style="background:#1e1e1e;color:#dcdcdc"> OnApplicationQuit()</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (_Reader </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc">_Reader</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Dispose();</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">_Reader </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (_Sensor </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (_Sensor</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">IsOpen)</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc">_Sensor</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Close();</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">&nbsp;</li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">_Sensor </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">}</span></li> </ol> </div> </div> </div> <p>The only difference from the previous post here is the call to set the tracking ID. Next, I added another script to load the custom gesture database and detect the gestures:</p> <div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:c08a4ef6-ce8e-4942-a637-cfd46bc47303" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"> <div class="le-pavsc-container"> <div style="background: #ddd; overflow: auto"> <ol start="1" style="background: #000000; margin: 0 0 0 2.5em; padding: 0 0 0 5px;"> <li><span style="background:#1e1e1e;color:#569cd6">public</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">class</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">CustomGestureManager</span><span style="background:#1e1e1e;color:#dcdcdc"> : </span><span style="background:#1e1e1e;color:#4ec9b0">MonoBehaviour</span><span style="background:#1e1e1e;color:#dcdcdc"> </span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">VisualGestureBuilderDatabase</span><span style="background:#1e1e1e;color:#dcdcdc"> _gestureDatabase;</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">VisualGestureBuilderFrameSource</span><span style="background:#1e1e1e;color:#dcdcdc"> _gestureFrameSource;</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">VisualGestureBuilderFrameReader</span><span style="background:#1e1e1e;color:#dcdcdc"> _gestureFrameReader;</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">KinectSensor</span><span style="background:#1e1e1e;color:#dcdcdc"> _kinect;</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">Gesture</span><span style="background:#1e1e1e;color:#dcdcdc"> _salute;</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">Gesture</span><span style="background:#1e1e1e;color:#dcdcdc"> _saluteProgress;</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">ParticleSystem</span><span style="background:#1e1e1e;color:#dcdcdc"> _ps;</span></li> <li class="le-pavsc-even">&nbsp;</li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">public</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">GameObject</span><span style="background:#1e1e1e;color:#dcdcdc"> AttachedObject;</span></li> <li class="le-pavsc-even">&nbsp;</li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">public</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">void</span><span style="background:#1e1e1e;color:#dcdcdc"> SetTrackingId(</span><span style="background:#1e1e1e;color:#569cd6">ulong</span><span style="background:#1e1e1e;color:#dcdcdc"> id)</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">_gestureFrameReader</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">IsPaused </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">false</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">_gestureFrameSource</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">TrackingId </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> id;</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">_gestureFrameReader</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">FrameArrived </span><span style="background:#1e1e1e;color:#b4b4b4">+=</span><span style="background:#1e1e1e;color:#dcdcdc"> _gestureFrameReader_FrameArrived;</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#57a64a">// Use this for initialization</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">void</span><span style="background:#1e1e1e;color:#dcdcdc"> Start () </span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (AttachedObject </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">_ps </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> AttachedObject</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">particleSystem;</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc">_ps</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">emissionRate </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b5cea8">4</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">_ps</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">startColor </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Color</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">blue;</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">_kinect </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">KinectSensor</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">GetDefault();</span></li> <li class="le-pavsc-even">&nbsp;</li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">_gestureDatabase </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">VisualGestureBuilderDatabase</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Create(</span><span style="background:#1e1e1e;color:#4ec9b0">Application</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">streamingAssetsPath </span><span style="background:#1e1e1e;color:#b4b4b4">+</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#d69d85">&quot;/salute.gbd&quot;</span><span style="background:#1e1e1e;color:#dcdcdc">);</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">_gestureFrameSource </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">VisualGestureBuilderFrameSource</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Create(_kinect, </span><span style="background:#1e1e1e;color:#b5cea8">0</span><span style="background:#1e1e1e;color:#dcdcdc">);</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">foreach</span><span style="background:#1e1e1e;color:#dcdcdc"> (</span><span style="background:#1e1e1e;color:#569cd6">var</span><span style="background:#1e1e1e;color:#dcdcdc"> gesture </span><span style="background:#1e1e1e;color:#569cd6">in</span><span style="background:#1e1e1e;color:#dcdcdc"> _gestureDatabase</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">AvailableGestures)</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc">_gestureFrameSource</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">AddGesture(gesture);</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (gesture</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Name </span><span style="background:#1e1e1e;color:#b4b4b4">==</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#d69d85">&quot;salute&quot;</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc">_salute </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> gesture;</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (gesture</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Name </span><span style="background:#1e1e1e;color:#b4b4b4">==</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#d69d85">&quot;saluteProgress&quot;</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc">_saluteProgress </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> gesture;</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">_gestureFrameReader </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> _gestureFrameSource</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">OpenReader();</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">_gestureFrameReader</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">IsPaused </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">true</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">void</span><span style="background:#1e1e1e;color:#dcdcdc"> _gestureFrameReader_FrameArrived(</span><span style="background:#1e1e1e;color:#569cd6">object</span><span style="background:#1e1e1e;color:#dcdcdc"> sender, </span><span style="background:#1e1e1e;color:#4ec9b0">VisualGestureBuilderFrameArrivedEventArgs</span><span style="background:#1e1e1e;color:#dcdcdc"> e)</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">VisualGestureBuilderFrameReference</span><span style="background:#1e1e1e;color:#dcdcdc"> frameReference </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> e</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">FrameReference;</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">using</span><span style="background:#1e1e1e;color:#dcdcdc"> (</span><span style="background:#1e1e1e;color:#4ec9b0">VisualGestureBuilderFrame</span><span style="background:#1e1e1e;color:#dcdcdc"> frame </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> frameReference</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">AcquireFrame())</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (frame </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">&amp;&amp;</span><span style="background:#1e1e1e;color:#dcdcdc"> frame</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">DiscreteGestureResults </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>                <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (AttachedObject </span><span style="background:#1e1e1e;color:#b4b4b4">==</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li class="le-pavsc-even">                    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">return</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">DiscreteGestureResult</span><span style="background:#1e1e1e;color:#dcdcdc"> result </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (frame</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">DiscreteGestureResults</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Count </span><span style="background:#1e1e1e;color:#b4b4b4">&gt;</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b5cea8">0</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li>                    <span style="background:#1e1e1e;color:#dcdcdc">result </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> frame</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">DiscreteGestureResults[_salute];</span></li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (result </span><span style="background:#1e1e1e;color:#b4b4b4">==</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li>                    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">return</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li class="le-pavsc-even">&nbsp;</li> <li>                <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (result</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Detected </span><span style="background:#1e1e1e;color:#b4b4b4">==</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">true</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>                    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">var</span><span style="background:#1e1e1e;color:#dcdcdc"> progressResult </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> frame</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">ContinuousGestureResults[_saluteProgress];</span></li> <li class="le-pavsc-even">                    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (AttachedObject </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li>                    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">                        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">var</span><span style="background:#1e1e1e;color:#dcdcdc"> prog </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> progressResult</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Progress;</span></li> <li>                        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">float</span><span style="background:#1e1e1e;color:#dcdcdc"> scale </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b5cea8">0.5f</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">+</span><span style="background:#1e1e1e;color:#dcdcdc"> prog </span><span style="background:#1e1e1e;color:#b4b4b4">*</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b5cea8">3.0f</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li class="le-pavsc-even">                        <span style="background:#1e1e1e;color:#dcdcdc">AttachedObject</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">transform</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">localScale </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">new</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Vector3</span><span style="background:#1e1e1e;color:#dcdcdc">(scale, scale, scale);</span></li> <li>                        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (_ps </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li class="le-pavsc-even">                        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>                            <span style="background:#1e1e1e;color:#dcdcdc">_ps</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">emissionRate </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b5cea8">100</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">*</span><span style="background:#1e1e1e;color:#dcdcdc"> prog;</span></li> <li class="le-pavsc-even">                            <span style="background:#1e1e1e;color:#dcdcdc">_ps</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">startColor </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Color</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">red;</span></li> <li>                        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">                    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>                <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">                <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">else</span></li> <li>                <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">                    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (_ps </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">null</span><span style="background:#1e1e1e;color:#dcdcdc">)</span></li> <li>                    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">                        <span style="background:#1e1e1e;color:#dcdcdc">_ps</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">emissionRate </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b5cea8">4</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li>                        <span style="background:#1e1e1e;color:#dcdcdc">_ps</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">startColor </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Color</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">blue;</span></li> <li class="le-pavsc-even">                    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>                <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li><span style="background:#1e1e1e;color:#dcdcdc">}</span></li> </ol> </div> </div> </div> <p>This code is more or less the same as the code here <a title="http://peted.azurewebsites.net/visual-gesture-builder-kinect-4-windows-v2-code/" href="http://peted.azurewebsites.net/visual-gesture-builder-kinect-4-windows-v2-code/">http://peted.azurewebsites.net/visual-gesture-builder-kinect-4-windows-v2-code/</a>.</p> <h3>Attaching a Game Object</h3> <p>Once this script is in place you can set the ‘AttachedObject’ variable via the Unity3D UI by dragging a game object onto the field on the property editor. I created a particle system for the sample and dragged it on after changing some of the properties. When a gesture is detected I use the progress value to alter some properties on the particle system; changing colours and emission rate.</p> <h3>Accessing the Gesture Database</h3> <p>Notice that the code above imports the .gbd file from my <a href="http://peted.azurewebsites.net/visual-gesture-builder-kinect-4-windows-v2-code/">previous post</a> which contains a discrete gesture ‘salute’ and a continuous gesture ‘salute progress’. To access the database you can use using the streamingAssetsPath provided by Unity to gain access to local resources; more details <a href="http://docs.unity3d.com/ScriptReference/Application-streamingAssetsPath.html">here</a>. </p> <h3>Build settings</h3> <p>You can use the Unity <strong>File &gt; Build Settings</strong>… dialog to configure the output project (in this case Windows Store output).</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2014/11/unitybuildsettings_custom.png"><img title="unitybuildsettings_custom" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" border="0" alt="unitybuildsettings_custom" src="http://peted.azurewebsites.net/wp-content/uploads/2014/11/unitybuildsettings_custom_thumb.png" width="571" height="640"></a> </p> <p></p> <p></p> <p>Building this will generate the Windows Store App project which you can load into Visual Studio and run\debug as required. At this stage it is important to remember to do the following:</p> <blockquote> <p>Add Webcam and Microphone capabilities to your app by editing the Windows Store app package manifest</p></blockquote> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2014/11/manifest.png"><img title="manifest" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" border="0" alt="manifest" src="http://peted.azurewebsites.net/wp-content/uploads/2014/11/manifest_thumb.png" width="868" height="522"></a> </p> <blockquote> <p>Add references to the app to <strong>WindowsPreview.Kinect</strong> and <strong>Microsoft.Kinect.VisualGestureBuild</strong></p></blockquote> <p></p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2014/11/referecnes.png"><img title="referecnes" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" border="0" alt="referecnes" src="http://peted.azurewebsites.net/wp-content/uploads/2014/11/referecnes_thumb.png" width="381" height="453"></a> </p> <p>These last two have caught me out on a number of occasions and it’s not always obvious when this is the cause of problems.</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2014/11/salutedetected.png"><img title="salutedetected" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" border="0" alt="salutedetected" src="http://peted.azurewebsites.net/wp-content/uploads/2014/11/salutedetected_thumb.png" width="861" height="486"></a> </p> <p>This shows the final result captured mid-salute.</p> <p>Find the sample project <a href="http://1drv.ms/1uKAxK2">here</a>.</p> <p>Other useful resources:</p> <p>Another working sample - <a title="https://github.com/carmines/workshop/blob/dev/Unity/VGBSample.unitypackage" href="https://github.com/carmines/workshop/blob/dev/Unity/VGBSample.unitypackage">https://github.com/carmines/workshop/blob/dev/Unity/VGBSample.unitypackage</a></p>
