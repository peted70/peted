---
layout: single
title: skydrive upload c# metro
date: 2012-03-17 20:39
author_profile: true
comments: true
categories: [Metro, skydrive, skydrive, upload, win8, Windows 8, WinRT, winrt, xaml]
header:
    teaserlogo: 'assets/images/'
    teaser: 'assets/images/'
---
<p>Peter Daukintis</p>  <p>A preview of the latest Live SDK for Metro apps can be downloaded here <a title="https://connect.microsoft.com/site1226" href="https://connect.microsoft.com/site1226">https://connect.microsoft.com/site1226</a>. This is for usage with the Windows 8 Consumer Preview (Note that the SDK is a preview version with no go-live license).</p>  <p>After installing you can add a reference via ‘add Reference’ &gt; and select Windows &gt; Extensions in the Reference Manager dialog.</p>  <p><a href="{{ site.baseurl }}/assets/images/2012/03/livesdkref.png"><img style="background-image:none;padding-left:0;padding-right:0;display:block;float:none;margin-left:auto;margin-right:auto;padding-top:0;border-width:0;" title="livesdkRef" border="0" alt="livesdkRef" src="{{ site.baseurl }}/assets/images/2012/03/livesdkref_thumb.png" width="475" height="347" /></a></p>  <p>In order to configure sign in on Windows Phone a client ID was required; this is different for Metro-style Apps as you now need to register your app package name and publisher identity here <a title="http://go.microsoft.com/fwlink/?LinkId=227628" href="http://go.microsoft.com/fwlink/?LinkId=227628">http://go.microsoft.com/fwlink/?LinkId=227628</a>.</p>  <p>Once registered you will be provided with a new Package Name – copy this back into your app manifest.</p>  <p>Once this is complete, using the following code you will be able to sign in:</p>  <p>XAML:</p>  <p>add this namespace declaration</p>  <p><span style="background:#1e1e1e;color:#92caf4;">xmlns</span><span style="background:#1e1e1e;color:gray;">:</span><span style="background:#1e1e1e;color:#92caf4;">live</span><span style="background:#1e1e1e;color:gray;">=</span><span style="background:#1e1e1e;color:#569cd6;">&quot;using:Microsoft.Live.Controls&quot;</span></p>  <p><span style="background:#1e1e1e;color:#569cd6;"><font color="#ffffff">and a sign in button</font></span></p> <a href="{{ site.baseurl }}/assets/images/2012/03/accessrequest.png">   <p>     <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:cf601697-0c47-4dc1-8af1-3fe674726b3b" class="wlWriterEditableSmartContent"> <div style="border:#000080 1px solid;color:#000;font-family:'Courier New', Courier, Monospace;font-size:10pt;"> <div style="background-color:#000000;overflow:auto;padding:2px 5px;"><span style="background:#1e1e1e;color:#ababab;"></span><span style="background:#1e1e1e;color:#808080;">&lt;</span><span style="background:#1e1e1e;color:#e6e6e6;">live</span><span style="background:#1e1e1e;color:#808080;">:</span><span style="background:#1e1e1e;color:#e6e6e6;">SignInButton</span><span style="background:#1e1e1e;color:#92caf4;"> x</span><span style="background:#1e1e1e;color:#808080;">:</span><span style="background:#1e1e1e;color:#92caf4;">Name</span><span style="background:#1e1e1e;color:#808080;">=</span><span style="background:#1e1e1e;color:#569cd6;">&quot;btnSignin&quot;</span><span style="background:#1e1e1e;color:#92caf4;"> Scopes</span><span style="background:#1e1e1e;color:#808080;">=</span><span style="background:#1e1e1e;color:#569cd6;">&quot;wl.signin wl.basic wl.skydrive wl.skydrive_update&quot;</span><br>                   <span style="background:#1e1e1e;color:#c8c8c8;"></span><span style="background:#1e1e1e;color:#92caf4;"> SessionChanged</span><span style="background:#1e1e1e;color:#808080;">=</span><span style="background:#1e1e1e;color:#569cd6;">&quot;SignInButtonSessionChanged&quot;</span><span style="background:#1e1e1e;color:#808080;"> /&gt;</span></div> </div> </div>   </p>    <p><font color="#cccccc"></font></p>   <img style="background-image:none;padding-left:0;padding-right:0;display:block;float:none;margin-left:auto;margin-right:auto;padding-top:0;border-width:0;" title="AccessRequest" border="0" alt="AccessRequest" src="{{ site.baseurl }}/assets/images/2012/03/accessrequest_thumb.png" width="575" height="432" /></a>      <p>&#160;</p>  <p>The Live id session status is reported by the SessionChanged event so I handle it like this, storing the session object for later use:</p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:6432d340-f0bd-40f7-a6af-083dee548f4b" class="wlWriterEditableSmartContent"> <div style="border:#000080 1px solid;color:#000;font-family:'Courier New', Courier, Monospace;font-size:10pt;"> <div style="background-color:#000000;overflow:auto;padding:2px 5px;"><span style="background:#1e1e1e;color:#c8c8c8;"></span><span style="background:#1e1e1e;color:#569cd6;">private</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#569cd6;">void</span><span style="background:#1e1e1e;color:#c8c8c8;"> SignInButtonSessionChanged(</span><span style="background:#1e1e1e;color:#569cd6;">object</span><span style="background:#1e1e1e;color:#c8c8c8;"> sender, </span><span style="background:#1e1e1e;color:#4ec9b0;">LiveConnectSessionChangedEventArgs</span><span style="background:#1e1e1e;color:#c8c8c8;"> e)</span><br> <span style="background:#1e1e1e;color:#c8c8c8;">{</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;"></span><span style="background:#1e1e1e;color:#569cd6;">if</span><span style="background:#1e1e1e;color:#c8c8c8;"> (e</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">Status </span><span style="background:#1e1e1e;color:#9b9b9b;">==</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#b8d7a3;">LiveConnectSessionStatus</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">Connected)</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;">{</span><br>         <span style="background:#1e1e1e;color:#c8c8c8;">_liveConnectSession </span><span style="background:#1e1e1e;color:#9b9b9b;">=</span><span style="background:#1e1e1e;color:#c8c8c8;"> e</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">Session;</span><br>         <span style="background:#1e1e1e;color:#c8c8c8;">UpdateEnabled();</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;">}</span><br> <span style="background:#1e1e1e;color:#c8c8c8;">}</span></div> </div> </div>  <p>Next we need a way to get hold of an image so I just used the File Picker to retrieve one (I added a way to capture an image using the camera but I couldn’t test it so it probably won’t work <img style="border-style:none;" class="wlEmoticon wlEmoticon-sadsmile" alt="Sad smile" src="{{ site.baseurl }}/assets/images/2012/03/wlemoticon-sadsmile.png" />) </p>  <p>Here’s the code for the file picker:</p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:66670bfc-0131-4018-9bc9-429fe4236b29" class="wlWriterEditableSmartContent"> <div style="border:#000080 1px solid;color:#000;font-family:'Courier New', Courier, Monospace;font-size:10pt;"> <div style="background-color:#000000;overflow:auto;padding:2px 5px;"><span style="background:#1e1e1e;color:#c8c8c8;"></span><span style="background:#1e1e1e;color:#569cd6;">async</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#569cd6;">private</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#569cd6;">void</span><span style="background:#1e1e1e;color:#c8c8c8;"> ChooseFile(</span><span style="background:#1e1e1e;color:#569cd6;">object</span><span style="background:#1e1e1e;color:#c8c8c8;"> sender, </span><span style="background:#1e1e1e;color:#4ec9b0;">RoutedEventArgs</span><span style="background:#1e1e1e;color:#c8c8c8;"> e)</span><br> <span style="background:#1e1e1e;color:#c8c8c8;">{</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;"></span><span style="background:#1e1e1e;color:#4ec9b0;">FileOpenPicker</span><span style="background:#1e1e1e;color:#c8c8c8;"> openPicker </span><span style="background:#1e1e1e;color:#9b9b9b;">=</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#569cd6;">new</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#4ec9b0;">FileOpenPicker</span><span style="background:#1e1e1e;color:#c8c8c8;">();</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;">openPicker</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">ViewMode </span><span style="background:#1e1e1e;color:#9b9b9b;">=</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#b8d7a3;">PickerViewMode</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">Thumbnail;</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;">openPicker</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">SuggestedStartLocation </span><span style="background:#1e1e1e;color:#9b9b9b;">=</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#b8d7a3;">PickerLocationId</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">PicturesLibrary;</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;">openPicker</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">FileTypeFilter</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">Add(</span><span style="background:#1e1e1e;color:#d69d85;">&quot;.jpg&quot;</span><span style="background:#1e1e1e;color:#c8c8c8;">);</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;">openPicker</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">FileTypeFilter</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">Add(</span><span style="background:#1e1e1e;color:#d69d85;">&quot;.jpeg&quot;</span><span style="background:#1e1e1e;color:#c8c8c8;">);</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;">openPicker</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">FileTypeFilter</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">Add(</span><span style="background:#1e1e1e;color:#d69d85;">&quot;.png&quot;</span><span style="background:#1e1e1e;color:#c8c8c8;">);</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;"></span><span style="background:#1e1e1e;color:#4ec9b0;">StorageFile</span><span style="background:#1e1e1e;color:#c8c8c8;"> file </span><span style="background:#1e1e1e;color:#9b9b9b;">=</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#569cd6;">await</span><span style="background:#1e1e1e;color:#c8c8c8;"> openPicker</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">PickSingleFileAsync();</span><br> <br>     <span style="background:#1e1e1e;color:#c8c8c8;"></span><span style="background:#1e1e1e;color:#569cd6;">if</span><span style="background:#1e1e1e;color:#c8c8c8;"> (file </span><span style="background:#1e1e1e;color:#9b9b9b;">!=</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#569cd6;">null</span><span style="background:#1e1e1e;color:#c8c8c8;">)</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;">{</span><br>         <span style="background:#1e1e1e;color:#c8c8c8;">_filename </span><span style="background:#1e1e1e;color:#9b9b9b;">=</span><span style="background:#1e1e1e;color:#c8c8c8;"> file</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">Name;</span><br>         <span style="background:#1e1e1e;color:#c8c8c8;"></span><span style="background:#1e1e1e;color:#4ec9b0;">BitmapImage</span><span style="background:#1e1e1e;color:#c8c8c8;"> bitmapImage </span><span style="background:#1e1e1e;color:#9b9b9b;">=</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#569cd6;">new</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#4ec9b0;">BitmapImage</span><span style="background:#1e1e1e;color:#c8c8c8;">();</span><br>         <span style="background:#1e1e1e;color:#c8c8c8;">_stream </span><span style="background:#1e1e1e;color:#9b9b9b;">=</span><span style="background:#1e1e1e;color:#c8c8c8;"> (</span><span style="background:#1e1e1e;color:#4ec9b0;">FileRandomAccessStream</span><span style="background:#1e1e1e;color:#c8c8c8;">)</span><span style="background:#1e1e1e;color:#569cd6;">await</span><span style="background:#1e1e1e;color:#c8c8c8;"> file</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">OpenAsync(</span><span style="background:#1e1e1e;color:#b8d7a3;">FileAccessMode</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">Read);</span><br>         <span style="background:#1e1e1e;color:#c8c8c8;">bitmapImage</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">SetSource(_stream);</span><br>         <span style="background:#1e1e1e;color:#c8c8c8;">myImage</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">Source </span><span style="background:#1e1e1e;color:#9b9b9b;">=</span><span style="background:#1e1e1e;color:#c8c8c8;"> bitmapImage;</span><br>         <span style="background:#1e1e1e;color:#c8c8c8;">UpdateEnabled();</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;">}</span><br> <span style="background:#1e1e1e;color:#c8c8c8;">}</span></div> </div> </div>  <p>and finally, what it was all about, uploading to skydrive:</p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:49922e4d-0c95-40e3-b2c2-958eff330349" class="wlWriterEditableSmartContent"> <div style="border:#000080 1px solid;color:#000;font-family:'Courier New', Courier, Monospace;font-size:10pt;"> <div style="background-color:#000000;overflow:auto;padding:2px 5px;"><span style="background:#1e1e1e;color:#c8c8c8;"></span><span style="background:#1e1e1e;color:#569cd6;">private</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#569cd6;">void</span><span style="background:#1e1e1e;color:#c8c8c8;"> Upload(</span><span style="background:#1e1e1e;color:#4ec9b0;">Stream</span><span style="background:#1e1e1e;color:#c8c8c8;"> data, </span><span style="background:#1e1e1e;color:#569cd6;">string</span><span style="background:#1e1e1e;color:#c8c8c8;"> filename)</span><br> <span style="background:#1e1e1e;color:#c8c8c8;">{</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;"></span><span style="background:#1e1e1e;color:#569cd6;">var</span><span style="background:#1e1e1e;color:#c8c8c8;"> liveConnectClient </span><span style="background:#1e1e1e;color:#9b9b9b;">=</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#569cd6;">new</span><span style="background:#1e1e1e;color:#c8c8c8;"> </span><span style="background:#1e1e1e;color:#4ec9b0;">LiveConnectClient</span><span style="background:#1e1e1e;color:#c8c8c8;">(_liveConnectSession);</span><br> <br>     <span style="background:#1e1e1e;color:#c8c8c8;">liveConnectClient</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">UploadCompleted </span><span style="background:#1e1e1e;color:#9b9b9b;">+=</span><span style="background:#1e1e1e;color:#c8c8c8;"> LiveConnectClientUploadCompleted;</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;"></span><span style="background:#1e1e1e;color:#4ec9b0;">VisualStateManager</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">GoToState(</span><span style="background:#1e1e1e;color:#569cd6;">this</span><span style="background:#1e1e1e;color:#c8c8c8;">, </span><span style="background:#1e1e1e;color:#d69d85;">&quot;Busy&quot;</span><span style="background:#1e1e1e;color:#c8c8c8;">, </span><span style="background:#1e1e1e;color:#569cd6;">true</span><span style="background:#1e1e1e;color:#c8c8c8;">);</span><br>     <span style="background:#1e1e1e;color:#c8c8c8;">liveConnectClient</span><span style="background:#1e1e1e;color:#9b9b9b;">.</span><span style="background:#1e1e1e;color:#c8c8c8;">UploadAsync(</span><span style="background:#1e1e1e;color:#d69d85;">&quot;me/skydrive&quot;</span><span style="background:#1e1e1e;color:#c8c8c8;">, filename, </span><span style="background:#1e1e1e;color:#569cd6;">true</span><span style="background:#1e1e1e;color:#c8c8c8;">, data, data);</span><br> <span style="background:#1e1e1e;color:#c8c8c8;">}</span></div> </div> </div>  <p>Here’s the ui whilst uploading an image:</p>  <p><a href="{{ site.baseurl }}/assets/images/2012/03/uploadspam.png"><img style="background-image:none;border-bottom:0;border-left:0;padding-left:0;padding-right:0;display:block;float:none;margin-left:auto;border-top:0;margin-right:auto;border-right:0;padding-top:0;" title="uploadspam" border="0" alt="uploadspam" src="{{ site.baseurl }}/assets/images/2012/03/uploadspam_thumb.png" width="643" height="498" /></a></p>  <p>&#160;</p>  <p>and when completed – displaying the json result returned by the upload.</p>  <p>&#160;</p>  <p><a href="{{ site.baseurl }}/assets/images/2012/03/uploadresults.png"><img style="background-image:none;border-bottom:0;border-left:0;padding-left:0;padding-right:0;display:block;float:none;margin-left:auto;border-top:0;margin-right:auto;border-right:0;padding-top:0;" title="uploadresults" border="0" alt="uploadresults" src="{{ site.baseurl }}/assets/images/2012/03/uploadresults_thumb.png" width="645" height="502" /></a></p>  <p>&#160;</p>  <p>and finally, the image on skydrive.</p>  <p>&#160;</p>  <p><a href="{{ site.baseurl }}/assets/images/2012/03/spamonskydrive.png"><img style="background-image:none;border-bottom:0;border-left:0;padding-left:0;padding-right:0;display:block;float:none;margin-left:auto;border-top:0;margin-right:auto;border-right:0;padding-top:0;" title="spamonskydrive" border="0" alt="spamonskydrive" src="{{ site.baseurl }}/assets/images/2012/03/spamonskydrive_thumb.png" width="640" height="431" /></a></p>  <p>The project can be found here <a title="https://skydrive.live.com/redir.aspx?cid=4f1b7368284539e5&amp;resid=4F1B7368284539E5!441&amp;parid=4F1B7368284539E5!123" href="https://skydrive.live.com/redir.aspx?cid=4f1b7368284539e5&amp;resid=4F1B7368284539E5!441&amp;parid=4F1B7368284539E5!123">https://skydrive.live.com/redir.aspx?cid=4f1b7368284539e5&amp;resid=4F1B7368284539E5!441&amp;parid=4F1B7368284539E5!123</a></p>
