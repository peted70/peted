---
layout: post
title: Visual Studio 2015 Preview &ndash; Mobile C++
date: 2015-02-04 11:20
author: peted70
comments: true
categories: [android, c#, c++, cross-platform, ios, Visual Studio, vs2015, windows]
---
<p>C++ has long been a great option for cross-platform mobile development particularly in the cases where you might have an existing C++ codebase or you have certain types of performance considerations. For this article I am going to constrain the subject to mobile platforms; iOS, Android and Windows but of course this could extend to any OS with C++ support. So let’s start by taking a look at the C++ support for each.</p> <h2>Android</h2> <p>Android provides an NDK (Native Development Kit) (see <a title="https://developer.android.com/tools/sdk/ndk/index.html" href="https://developer.android.com/tools/sdk/ndk/index.html">https://developer.android.com/tools/sdk/ndk/index.html</a>) for use when working with C++. The NDK includes a set of cross-toolchains (compilers, linkers, etc.) that can generate native ARM binaries on Linux, OS X, and Windows (with Cygwin) platforms. The Java Native interface (JNI) provides a way to interface native code with Java (more info on that here <a title="http://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/jniTOC.html" href="http://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/jniTOC.html">http://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/jniTOC.html</a>). You can use the NDK to write C++ code and you can either use the JNI to interface this code with a Java Android app or you can write a NativeActivity which provides the interface to application lifecycle events for your convenience. For my example I will use the JNI approach and I will create the project using Android Studio.After creating a new Blank Activity app I had to set up a few things:</p> <p>In local.properties I added an entry for the NDK location.</p> <blockquote> <p>ndk.dir=C\:\\Users\\pdaukin\\Documents\\Android\\ndk\\android-ndk-r10d</p></blockquote> <p>In the build.gradle file I added an entry to name my module</p> <blockquote> <p>ndk {<br>&nbsp;&nbsp;&nbsp; moduleName "Hello"<br>} </p></blockquote> <p>Now placing C++ code into src &gt; main &gt; jni will compile it into a library, in this case libHello.so</p> <p>The code I used I modified the hellojni sample from he NDK.</p><script src="https://gist.github.com/peted70/3a1b352be80829744540.js"></script> <p>Notice the function naming convention used. (You can generate this header using javac and javah command lines). The code to consume this from the Java activity is pretty straight-forward:</p><script src="https://gist.github.com/peted70/2998cdbe86d6aaea814a.js"></script> <p>To test this I used the new Visual Studio Android emulator from Android Studio. If the emulator is already running when you start debugging from Android Studio the emulator will appear as a running device debugging target.</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/vsemulatorinandroidstudio.png"><img title="vsemulatorinandroidstudio" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="vsemulatorinandroidstudio" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/vsemulatorinandroidstudio_thumb.png" width="744" height="436"></a> </p> <p>And here’s the final result:</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/WorkingAndroidStudio.png"><img title="WorkingAndroidStudio" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="WorkingAndroidStudio" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/WorkingAndroidStudio_thumb.png" width="733" height="375"></a> </p> <p>&nbsp;</p> <h2>iOS</h2> <p>Looks like this is easier in iOS if you are writing an Objective-C app since you can mix and match C++ and use it directly. You can’t do this with Swift directly; for that you would need an Objective-C wrapper. The Default compiler for C/C++/Objective-C in XCode 6.2 is set as Apple LLVM 6.0 for which the front-end compiler is Clang</p> <p>As an example, I tried to write a C++ class, within a dynamic shared library, and consume it from an Objective-C app:</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/xcodeconsumecpp.png"><img title="xcode-consumecpp" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="xcode-consumecpp" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/xcodeconsumecpp_thumb.png" width="733" height="569"></a> </p> <p>The NativeTest project shown above is an Objective-C iOS app in which I added a Label control to the ViewController. This app references the other project, which is a Framework encapsulating a dynamic shared library which contains a class called MyClass which, in turn, exposes a method which returns a string which I use to set the text of the Label in the UI. That’s about as simple as you can get but still illustrate how the C++ code can be used.</p> <p>&nbsp;</p><script src="https://gist.github.com/peted70/8ebe775556970c333a2b.js"></script> <p></p> <p></p> <p>This shows the result running in the iOS simulator on my Mac:</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/xcoderuncpp.png"><img title="xcode-runcpp" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="xcode-runcpp" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/xcoderuncpp_thumb.png" width="724" height="508"></a> </p> <h2>Windows</h2> <p>You can create a fully native Universal app in C++ which includes a XAML layer for the user interface or you can mix and match by wrapping your C++ as a WinRT component which could then be consumed from within a .NET or Javascript app.&nbsp; I’m not going to cover a WinRT component here since for this post I intend to use the former method; a C++ XAML Windows Phone app. In fact, there is no need to show how this is done since the UI code is also written in C++ so, any additional C++ can be written in place. On Windows the visual C++ compiler is used.</p> <h2>Unified Solution</h2> <p>At this point there is no direct support for creating an iOS native library so let’s put together a solution containing Android and Windows Phone and then speculate about what might be possible moving forwards. So the idea would be to have an architecture which looks a bit like the following:</p> <p>&nbsp;<a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/image.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/image_thumb.png" width="738" height="481"></a> </p> <p>(This is a slide that I borrowed from Herb Sutter’s presentation on <a title="http://channel9.msdn.com/events/Visual-Studio/Connect-event-2014/311" href="http://channel9.msdn.com/events/Visual-Studio/Connect-event-2014/311" target="_blank">C++: Conformance And Cross-Platform Mobile Development</a>)</p> <p>I won’t bother with the Platform Abstraction layers for my simple example but it’s not easy to see why these would be created in a real project. Herb also links to some online talks which detail projects (Office and Dropbox) which have employed C++ heavily in their cross-platform strategy.</p> <blockquote> <p>•CppCon talks (Sep 2014)  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; •From the Dropbox Trenches: A Deep Dive into Two Cross-Platform Mobile Apps Written in C++ <a href="http://youtu.be/5AZMEm3rZ2Y">http://youtu.be/5AZMEm3rZ2Y</a> (1 hour)  <p>&nbsp;&nbsp;&nbsp;&nbsp; starting from separate Obj-C and Java apps  <p>•C++ in Microsoft Office: How Microsoft Uses <br>&nbsp;&nbsp;&nbsp;&nbsp; C++ to Deliver Office Applications Across Windows, Apple, Android, and Web Platforms <a href="http://youtu.be/3HROqnw-nf4">http://</a><a href="http://youtu.be/3HROqnw-nf4">youtu.be/3HROqnw-nf4</a> (2 hours)  <p>&nbsp;&nbsp;&nbsp;&nbsp; starting from a C/C++ code base</p></blockquote> <p>The main concept here is to write as much of the code as standards-compliant C++ which can be shared by each platform. Following an MVVM (Model View ViewModel) approach fits quite nicely here as the platform-specific layer at the top would consist purely of user interface code and a binding layer and ideally the View Models would sit inside the C++ bit and be shared.</p> <p>I have worked on similar cross-platform code bases in the past but they have always involved retrieving the raw C++ files to each platform and building them within the environment that exists there. Bringing this within one tool would ease the burden of this workload.</p> <h6>Dynamic Shared Library</h6> <p>I started out by adding two apps to my solution; and Android c# app (Xamarin) and a Windows Phone C++ Xaml application. I then added one of the new templates in Visual Studio 2015, a <strong>Cross-Platform Dynamic Shared Library</strong>.</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/VSTemplateDSL.png"><img title="VS Template DSL" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="VS Template DSL" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/VSTemplateDSL_thumb.png" width="732" height="332"></a></p> <p>My solution now looks like this:</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/solutionexplorer.png"><img title="solutionexplorer" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="solutionexplorer" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/solutionexplorer_thumb.png" width="482" height="278"></a></p> <p>Note that within the SharedObject folder there are three projects; two for the platform specific code and the other where code can be added which can be shared. Each platform specific project is built separately and has it’s own output. The Android library project is built using the LLVM compiler toolchain and the Windows Phone library project is built using the visual C++ toolchain.&nbsp;&nbsp; </p> <p>Effectively, the code in the shared project will get included into each platform specific project at compile time unless a file of that name already exists there. This provides another way, alongside using #ifdef platform defines of overriding shared code. Another nice IDE feature is that in the code editor you can access a drop-down which allows you to toggle the current build context, i.e. android or windows, in this case.</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/buildcontext.png"><img title="buildcontext" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="buildcontext" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/buildcontext_thumb.png" width="730" height="407"></a> </p> <p>The result of toggling is that code irrelevant to the ‘current’ context is greyed out and error/warning squiggles are coloured appropriately to allow you to understand in which contexts they exist.</p> <p>So now we have all of the required projects how do we reference the shared libraries from the app projects?</p> <h6>Android Shared Library</h6> <p>The output of the Android Shared Library uses the Unix shared library naming conventions and so is prefixed with ‘lib’ and the file extension is ‘.so’. I used the Add reference dialog fro the Android app project to add a project reference to the Android shared library. Then I used DllImport to reference a function inside the shared library like this:</p> <div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:d2009ef1-bbee-402f-b35d-a5a83a6e5eac" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"> <div class="le-pavsc-container"> <div style="background: #ddd; overflow: auto"> <ol start="1" style="background: #000000; margin: 0 0 0 2em; padding: 0 0 0 5px;"> <li><span style="background:#1e1e1e;color:#dcdcdc">[</span><span style="background:#1e1e1e;color:#4ec9b0">DllImport</span><span style="background:#1e1e1e;color:#dcdcdc">(</span><span style="background:#1e1e1e;color:#d69d85">&quot;libSharedObject.Android.so&quot;</span><span style="background:#1e1e1e;color:#dcdcdc">, CharSet </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b8d7a3">CharSet</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Ansi, CallingConvention </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b8d7a3">CallingConvention</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">StdCall)]</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">[</span><span style="background:#1e1e1e;color:#569cd6">return</span><span style="background:#1e1e1e;color:#dcdcdc">: </span><span style="background:#1e1e1e;color:#4ec9b0">MarshalAs</span><span style="background:#1e1e1e;color:#dcdcdc">(</span><span style="background:#1e1e1e;color:#b8d7a3">UnmanagedType</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">LPStr)]</span></li> <li><span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">public</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">static</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">extern</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">string</span><span style="background:#1e1e1e;color:#dcdcdc"> GetTemplateInfo2();</span></li> </ol> </div> </div> </div> <p></p> <p>Where the function in the shared library is declared in SharedObject.h like this</p> <div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:22133ece-9360-4cad-95c8-a37c096c7806" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"> <div class="le-pavsc-container"> <div style="background: #ddd; overflow: auto"> <ol start="1" style="background: #000000; margin: 0 0 0 2em; padding: 0 0 0 5px;"> <li><span style="background:#1e1e1e;color:#569cd6">extern</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#d69d85">&quot;C&quot;</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">const</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">char</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">*</span><span style="background:#1e1e1e;color:#c8c8c8">GetTemplateInfo2</span><span style="background:#1e1e1e;color:#b4b4b4">();</span></li> </ol> </div> </div> </div> <p>and implemented in SharedObject.cpp like this:</p> <div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:ede6cc96-979e-4e85-8628-c562cc5971ab" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"> <div class="le-pavsc-container"> <div style="background: #ddd; overflow: auto"> <ol start="1" style="background: #000000; margin: 0 0 0 2.5em; padding: 0 0 0 5px;"> <li><span style="background:#1e1e1e;color:#9b9b9b">#include</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#d69d85">&quot;SharedObject.h&quot;</span></li> <li class="le-pavsc-even">&nbsp;</li> <li><span style="background:#1e1e1e;color:#569cd6">const</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">char</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">*</span><span style="background:#1e1e1e;color:#c8c8c8">GetTemplateInfo2</span><span style="background:#1e1e1e;color:#b4b4b4">()</span><span style="background:#1e1e1e;color:#dcdcdc"> </span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li><span style="background:#1e1e1e;color:#9b9b9b">#ifdef</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#bd63c5">__ANDROID__</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">return</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#d69d85">&quot;Hello from Android C++!&quot;</span><span style="background:#1e1e1e;color:#b4b4b4">;</span><span style="background:#1e1e1e;color:#dcdcdc"> </span></li> <li><span style="background:#1e1e1e;color:#9b9b9b">#else</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">return</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#d69d85">&quot;Hello from Windows C++!&quot;</span><span style="background:#1e1e1e;color:#b4b4b4">;</span></li> <li><span style="background:#1e1e1e;color:#9b9b9b">#endif</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">}</span></li> </ol> </div> </div> </div> <p>I could have provided different SharedObject.cpp files in each platform-specific project but in this case I was lazy and just used the pre-processor. Calling the imported function from the Android MainActivity like this</p> <div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:6de7d53a-64fc-4b06-9a86-556c970f6f80" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"> <div class="le-pavsc-container"> <div style="background: #ddd; overflow: auto"> <ol start="1" style="background: #000000; margin: 0 0 0 2em; padding: 0 0 0 5px;"> <li><span style="background:#1e1e1e;color:#dcdcdc">button</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Click </span><span style="background:#1e1e1e;color:#b4b4b4">+=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">delegate</span><span style="background:#1e1e1e;color:#dcdcdc"> { button</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Text </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> GetTemplateInfo2(); };</span></li> </ol> </div> </div> </div> <p>works as expected in the new Visual Studio Android Emulator.</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/androidemulator.png"><img title="androidemulator" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="androidemulator" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/androidemulator_thumb.png" width="350" height="550"></a> </p> <blockquote> <p><font style="background-color: #ffffff">Note, if you get an error ‘</font>DWP Handshake failed’ problem when deploying Android app from Visual Studio – I fixed this by switching off Use Fast Deployment</p></blockquote> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/projsettingsandroid.png"><img title="projsettingsandroid" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="projsettingsandroid" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/projsettingsandroid_thumb.png" width="521" height="301"></a> </p> <h6>Windows Shared Library</h6> <p>The output here is a dynamic link library with ‘.dll’ extension and similar to the Android project I added a project reference to this from the Windows C++ XAML app. Examining the output dll file shows that by default no functions are exported (I used dumpbin.exe /exports – another alternative is to use dependency walker).</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/dumpbin.png"><img title="dumpbin" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="dumpbin" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/dumpbin_thumb.png" width="730" height="297"></a> </p> <p>I fixed this by adding a .def file to the project and configuring the project to use it. Here are the contents of the .def file:</p> <div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:deb35820-4b2a-4364-99a9-87c01705c6bb" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"> <div class="le-pavsc-container"> <div style="background: #ddd; overflow: auto"> <ol start="1" style="background: #000000; margin: 0 0 0 2em; padding: 0 0 0 5px;"> <li><span style="background:#1e1e1e;color:#dcdcdc">LIBRARY SharedObject.Windows</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">EXPORTS</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">GetTemplateInfo2</span></li> </ol> </div> </div> </div> <p></p> <p>Building and running dumpbin again produces:</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/dumpbin2.png"><img title="dumpbin2" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="dumpbin2" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/dumpbin2_thumb.png" width="730" height="430"></a> </p> <p></p> <p>Notice the ‘GetTemplateInfo2’ function which, as it is declared extern “C” in the header doesn’t have it’s name in the mangled form that a C++ compiler would use. Ok, so now I can add a project reference from the C++ app to the shared project and since everything is native I can just reference the C++ header and lib file and call the exported function directly. However, I tried this and couldn’t get it to work like this so instead of calling the function like this:</p> <div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:ce856bc8-fe9a-4d12-8b9d-b897f83d81d6" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"> <div class="le-pavsc-container"> <div style="background: #ddd; overflow: auto"> <ol start="1" style="background: #000000; margin: 0 0 0 2em; padding: 0 0 0 5px;"> <li><span style="background:#1e1e1e;color:#569cd6">const</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">char</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">*</span><span style="background:#1e1e1e;color:#c8c8c8">str</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#c8c8c8">GetTemplateInfo2</span><span style="background:#1e1e1e;color:#b4b4b4">();</span></li> </ol> </div> </div> </div> <p>I resorted to this:</p> <div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:6a5183f2-7f4a-4f1d-a35b-7e0c17adf26f" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"> <div class="le-pavsc-container"> <div style="background: #ddd; overflow: auto"> <ol start="1" style="background: #000000; margin: 0 0 0 2.5em; padding: 0 0 0 5px;"> <li><span style="background:#1e1e1e;color:#569cd6">const</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">char</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">*</span><span style="background:#1e1e1e;color:#c8c8c8">GetText</span><span style="background:#1e1e1e;color:#b4b4b4">()</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">auto</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#c8c8c8">mod</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#c8c8c8">LoadPackagedLibrary</span><span style="background:#1e1e1e;color:#b4b4b4">(</span><span style="background:#1e1e1e;color:#d69d85">L&quot;SharedObject.Windows.dll&quot;</span><span style="background:#1e1e1e;color:#b4b4b4">,</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b5cea8">0</span><span style="background:#1e1e1e;color:#b4b4b4">);</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">(</span><span style="background:#1e1e1e;color:#c8c8c8">mod</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">==</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">nullptr</span><span style="background:#1e1e1e;color:#b4b4b4">)</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">auto</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#c8c8c8">err</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#c8c8c8">GetLastError</span><span style="background:#1e1e1e;color:#b4b4b4">();</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">else</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">auto</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#c8c8c8">proc</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">(</span><span style="background:#1e1e1e;color:#4ec9b0">GetStringFnType</span><span style="background:#1e1e1e;color:#b4b4b4">)</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#c8c8c8">GetProcAddress</span><span style="background:#1e1e1e;color:#b4b4b4">(</span><span style="background:#1e1e1e;color:#c8c8c8">mod</span><span style="background:#1e1e1e;color:#b4b4b4">,</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#d69d85">&quot;GetTemplateInfo2&quot;</span><span style="background:#1e1e1e;color:#b4b4b4">);</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">(</span><span style="background:#1e1e1e;color:#c8c8c8">proc</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">!=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">nullptr</span><span style="background:#1e1e1e;color:#b4b4b4">)</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">auto</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#c8c8c8">result</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#c8c8c8">proc</span><span style="background:#1e1e1e;color:#b4b4b4">();</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">return</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#c8c8c8">result</span><span style="background:#1e1e1e;color:#b4b4b4">;</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">&nbsp;</li> <li>        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#c8c8c8">FreeLibrary</span><span style="background:#1e1e1e;color:#b4b4b4">(</span><span style="background:#1e1e1e;color:#c8c8c8">mod</span><span style="background:#1e1e1e;color:#b4b4b4">);</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">return</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#d69d85">&quot;&quot;</span><span style="background:#1e1e1e;color:#b4b4b4">;</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">}</span></li> </ol> </div> </div> </div> <p>and the result running in the Windows Phone emulator:</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/02/windowsemulator.png"><img title="windowsemulator" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="windowsemulator" src="http://peted.azurewebsites.net/wp-content/uploads/2015/02/windowsemulator_thumb.png" width="363" height="590"></a> </p> <h6>iOS</h6> <p>So what about iOS? Well, I spent a while thinking about what it might look like to add iOS into the mix and I came up with two different scenarios:</p> <blockquote> <p>The LLVM tool chain used in an iOS build is ported to Windows and used to cross-compile binaries as required for an iOS shared library (.dylib). I believe the UI side of things is closed source so a Mac would still be required but the dylib could be built on Windows and copied over.</p></blockquote> <blockquote> <p>The build happens on a Mac and Visual Studio communicated back and forth to orchestrate the build. </p></blockquote> <p>Either way there is a great advantage in having an IDE that understands this scenario and can provide tooling to make the job easier.</p> <p>The sample project can be see here <a title="https://github.com/peted70/cpp-xplat" href="https://github.com/peted70/cpp-xplat">https://github.com/peted70/cpp-xplat</a></p> <h2>Feedback</h2> <p>Remember, these tools are an early preview and as a result a bit rough around the edges – I’m sure the team building this out would appreciate your feedback. If you are trying out these features in Visual Studio 2015 Preview please provide feedback as follows:  <blockquote> <p>- <strong>Visual Studio Feedback</strong> via the smile/frown in the VS menu at the top for quick suggestions/bugs</p> <p>- <strong>Connect</strong> <a href="http://connect.microsoft.com/visualstudio">http://connect.microsoft.com/visualstudio</a> – for deeper issues/bugs that might require several iterations</p> <p>- <strong>UserVoice</strong> <a href="https://visualstudio.uservoice.com/">https://visualstudio.uservoice.com</a> – for feature suggestions</p></blockquote>
