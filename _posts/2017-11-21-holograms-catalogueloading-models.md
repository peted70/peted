---
layout: post
title: Holograms Catalogue&ndash;Loading Models
date: 2017-11-21 18:31
author: peted70
comments: true
categories: [3D, 3dmodels, azure, catalogue, cloud, gltf, HoloLens, unity, unity3d]
---
<p><a href="http://peted.azurewebsites.net/wp-content/uploads/2017/11/duckinunity.png"><img width="735" height="744" title="duckinunity" style="display: inline; background-image: none;" alt="duckinunity" src="http://peted.azurewebsites.net/wp-content/uploads/2017/11/duckinunity_thumb.png" border="0"></a><p>The 3D industry has been lacking a ubiquitous, standard file format for scene description. <blockquote><p>Many years ago I worked on a project involving creating camera motion paths to drive motion control rigs like this one below:<p><a href="http://peted.azurewebsites.net/wp-content/uploads/2017/11/motioncontrolrig.png"><img width="732" height="1104" title="motioncontrolrig" style="display: inline; background-image: none;" alt="motioncontrolrig" src="http://peted.azurewebsites.net/wp-content/uploads/2017/11/motioncontrolrig_thumb.png" border="0"></a></p><p>I worked with a company called Kaydara and with their proprietary file format FBX. Whilst it has become something of a standard since then it is not open and the rights now belong to Autodesk. </p></blockquote><p>It is pretty surprising that we’ve come this far without an open standard format so this is the motivation behind the creation of the <a href="https://www.khronos.org/gltf/" target="_blank">GLTF</a> specification by the Khronos Group. Significantly, Microsoft announced support for the standard so we'll see it incorporated in products moving forwards. Here’s a slide I used in a talk recently which has a <a href="https://www.khronos.org/gltf/" target="_blank">GLTF</a> model embedded which you can rotate/scale as a 3D model.</p><p><a href="http://peted.azurewebsites.net/wp-content/uploads/2017/11/gltfslidegif.gif"><img width="732" height="488" title="gltfslidegif" style="display: inline;" alt="gltfslidegif" src="http://peted.azurewebsites.net/wp-content/uploads/2017/11/gltfslidegif_thumb.gif"></a></p><p>You can read through the spec at the above link and also find up to date links to various tools, validators and import/exporters in various different environments and languages. I was looking for a way to dynamically load 3D models from my <a href="http://peted.azurewebsites.net/holograms-catalogueto-the-cloud/" target="_blank">cloud catalogue</a> and I wanted an open standard supported by content creation tools. After deciding on GLTF my starting point for this was the Unity GLTF loader <a href="https://github.com/KhronosGroup/UnityGLTF" target="_blank">here<script src="https://gist.github.com/peted70/f392a2e1f2668af314e71f3b530dd9d7.js"></script></a>&nbsp; The project there contains code for the GLTF components and some example scenes, note also that the code is dependent on JSON.NET. I briefly thought about isolating this dependency but decided it wasn't worth the effort for this sample. So my first step was to export to a custom package just the items I needed to be able to import a 3D scene.</p><p><a href="http://peted.azurewebsites.net/wp-content/uploads/2017/11/export-GLTF-Code.png"><img width="664" height="914" title="export GLTF Code" style="display: inline; background-image: none;" alt="export GLTF Code" src="http://peted.azurewebsites.net/wp-content/uploads/2017/11/export-GLTF-Code_thumb.png" border="0"></a></p><script src="https://gist.github.com/peted70/f392a2e1f2668af314e71f3b530dd9d7.js"></script><p>I’ve stripped out some of the details here so you can get an easy idea of how this works. We use <strong>SetShaderForMaterialType</strong> to set up our own materials to map onto the loaded models and we call <strong>load </strong>passing the URI and a parent <strong>GameObject</strong> for the scene. The loader will then parse and load the GLTF file on a background thread.<p><a href="http://peted.azurewebsites.net/wp-content/uploads/2017/11/gltfmodelsinunity.png"><img width="746" height="532" title="gltfmodelsinunity" style="display: inline; background-image: none;" alt="gltfmodelsinunity" src="http://peted.azurewebsites.net/wp-content/uploads/2017/11/gltfmodelsinunity_thumb.png" border="0"></a><p>This shows some of the GLTF sample models from the Khronos Github <a href="https://github.com/KhronosGroup/glTF-Sample-Models" target="_blank">here</a><blockquote><p>So now we have pieces to enable us to upload GLTF files into our <a href="http://peted.azurewebsites.net/holograms-catalogue/" target="_blank">cloud holograms catalogue</a>, download them on demand and load them into a Unity scene. What we don’t have yet is a way to present this to the user so I’ll cover that in the next post.</p></blockquote><p>The <strong>GLTFLoader</strong> class uses <strong>UnityWebRequest</strong> to make a request to a url to retrieve the GLTF format file, downloads it and parses it into memory and then creates a Unity scene representation from it.
