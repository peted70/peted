---
layout: single
title: metro background audio c# (release preview)
date: 2012-08-12 17:02
author_profile: true
comments: true
categories: [Uncategorized]
header:
    teaserlogo: 'assets/images/'
    teaser: 'assets/images/'
---
<p>Peter Daukintis</p>  <p>I have just updated the sample I created for this previous post <a href="http://babaandthepigman.wordpress.com/2012/03/17/metro-background-audio-c-consumer-preview/" target="_blank">metro background audio c# (consumer preview)</a>. I have re-jigged the code to work with Win 8 Release Preview and have spruced the ui up a little bit. </p>  <p>I also added functionality to retrieve some audio-related metadata from an audio file and displayed it in the user interface. When you select an audio file the code will retrieve a thumbnail from the system, store it in a local folder and display it using its local uri to reference it. Here’s a snippet of code to illustrate this: </p>  <p>   <div style="margin:0;display:inline;float:none;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:725d912a-24e0-4bde-a1a6-e41a387a1be5" class="wlWriterEditableSmartContent"> <div class="le-pavsc-container"> <div style="background-color:#000000;max-height:500px;overflow:auto;padding:2px 5px;"><span style="color:#f3f3f3;"></span><span style="color:#a2c4fd;">using</span><span style="color:#f3f3f3;"> (StorageItemThumbnail storageItemThumbnail =</span><br>     <span style="color:#f3f3f3;"></span><span style="color:#a2c4fd;">await</span><span style="color:#f3f3f3;"> file.GetThumbnailAsync(ThumbnailMode.SingleItem, 500, ThumbnailOptions.ResizeThumbnail))</span><br> <span style="color:#f3f3f3;"></span><span style="color:#a2c4fd;">using</span><span style="color:#f3f3f3;"> (IInputStream inputStreamAt = storageItemThumbnail.GetInputStreamAt(0))</span><br> <span style="color:#f3f3f3;"></span><span style="color:#a2c4fd;">using</span><span style="color:#f3f3f3;"> (</span><span style="color:#a2c4fd;">var</span><span style="color:#f3f3f3;"> dataReader = </span><span style="color:#a2c4fd;">new</span><span style="color:#f3f3f3;"> DataReader(inputStreamAt))</span><br> <span style="color:#f3f3f3;">{</span><br>     <span style="color:#f3f3f3;"></span><span style="color:#a2c4fd;">uint</span><span style="color:#f3f3f3;"> u = </span><span style="color:#a2c4fd;">await</span><span style="color:#f3f3f3;"> dataReader.LoadAsync((</span><span style="color:#a2c4fd;">uint</span><span style="color:#f3f3f3;">)storageItemThumbnail.Size);</span><br>     <span style="color:#f3f3f3;">IBuffer readBuffer = dataReader.ReadBuffer(u);</span><br> <br>     <span style="color:#f3f3f3;"></span><span style="color:#a2c4fd;">var</span><span style="color:#f3f3f3;"> tempFolder = ApplicationData.Current.LocalFolder;</span><br>     <span style="color:#f3f3f3;"></span><span style="color:#a2c4fd;">var</span><span style="color:#f3f3f3;"> imageFile = </span><span style="color:#a2c4fd;">await</span><span style="color:#f3f3f3;"> tempFolder.CreateFileAsync(filename, CreationCollisionOption.ReplaceExisting);</span><br> <br>     <span style="color:#f3f3f3;"></span><span style="color:#a2c4fd;">using</span><span style="color:#f3f3f3;"> (IRandomAccessStream randomAccessStream = </span><span style="color:#a2c4fd;">await</span><span style="color:#f3f3f3;"> imageFile.OpenAsync(FileAccessMode.ReadWrite))</span><br>     <span style="color:#f3f3f3;"></span><span style="color:#a2c4fd;">using</span><span style="color:#f3f3f3;"> (IOutputStream outputStreamAt = randomAccessStream.GetOutputStreamAt(0))</span><br>     <span style="color:#f3f3f3;">{</span><br>         <span style="color:#f3f3f3;"></span><span style="color:#a2c4fd;">await</span><span style="color:#f3f3f3;"> outputStreamAt.WriteAsync(readBuffer);</span><br>         <span style="color:#f3f3f3;"></span><span style="color:#a2c4fd;">await</span><span style="color:#f3f3f3;"> outputStreamAt.FlushAsync();</span><br>     <span style="color:#f3f3f3;">}</span><br> <span style="color:#f3f3f3;">}</span><br> <br> <span style="color:#f3f3f3;"></span><span style="color:#75ffa2;">// Finally, set up the Media Control</span><br> <span style="color:#f3f3f3;">MediaControl.TrackName = audioTrack.Properties.Title;</span><br> <span style="color:#f3f3f3;">MediaControl.ArtistName = audioTrack.Properties.Artist;</span><br> <span style="color:#f3f3f3;">MediaControl.AlbumArt = audioTrack.ThumbUri;</span></div> </div> </div> </p>  <p>Here are a few screenshots </p>  <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2012/08/nofile.png"><img style="background-image:none;border-bottom:0;border-left:0;padding-left:0;padding-right:0;display:block;float:none;margin-left:auto;border-top:0;margin-right:auto;border-right:0;padding-top:0;" title="nofile" border="0" alt="nofile" src="http://peted.azurewebsites.net/wp-content/uploads/2012/08/nofile_thumb.png" width="506" height="297" /></a></p>  <p>&#160;</p>  <p>After selecting a file the image and metadata are populated.</p>  <p>&#160;</p>  <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2012/08/bgaudio_small.png"><img style="background-image:none;border-bottom:0;border-left:0;padding-left:0;padding-right:0;display:block;float:none;margin-left:auto;border-top:0;margin-right:auto;border-right:0;padding-top:0;" title="bgaudio_small" border="0" alt="bgaudio_small" src="http://peted.azurewebsites.net/wp-content/uploads/2012/08/bgaudio_small_thumb.png" width="515" height="302" /></a></p>  <p>&#160;</p>  <p>Navigating away from the app and accessing the System Media Controls.</p>  <p>&#160;</p>  <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2012/08/mediacontroldesktopsmall.png"><img style="background-image:none;border-bottom:0;border-left:0;padding-left:0;padding-right:0;display:block;float:none;margin-left:auto;border-top:0;margin-right:auto;border-right:0;padding-top:0;" title="mediacontroldesktopsmall" border="0" alt="mediacontroldesktopsmall" src="http://peted.azurewebsites.net/wp-content/uploads/2012/08/mediacontroldesktopsmall_thumb.png" width="518" height="359" /></a></p>  <p>&#160;</p>  <p>Finally, a screen shot showing the design-time data in visual studio.</p>  <p>&#160;</p>  <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2012/08/designtimedataaudio.png"><img style="background-image:none;border-bottom:0;border-left:0;padding-left:0;padding-right:0;display:block;float:none;margin-left:auto;border-top:0;margin-right:auto;border-right:0;padding-top:0;" title="designtimedataaudio" border="0" alt="designtimedataaudio" src="http://peted.azurewebsites.net/wp-content/uploads/2012/08/designtimedataaudio_thumb.png" width="505" height="302" /></a></p>        <p>&#160;</p>  <p>The project can be downloaded from here <a title="http://sdrv.ms/NiW22g" href="http://sdrv.ms/NiW22g">http://sdrv.ms/NiW22g</a>.</p>
