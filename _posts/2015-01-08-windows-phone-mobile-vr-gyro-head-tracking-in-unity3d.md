---
layout: post
title: Windows Phone Mobile VR (Gyro Head Tracking in Unity3D)
date: 2015-01-08 19:57
author: peted70
comments: true
categories: [Unity, Unity3D, VR, VR, WP8, wp8]
---
<h5>Mobile VR</h5> <p>Recently I have been tracking the surge in interest in virtual reality and things certainly seem to have moved on in the last 20 years! Having experienced a number of Oculus Rift DK2 demos and various other mobile VR demos I have become excited about the rapid tech advances and the possibilities for the near-term future. Leaving future speculation aside, as a techie my first thoughts were to find some demos to run on my windows phone. I couldn’t find any so started to look into ways to create them myself using an inexpensive headset of some kind. </p> <p>If you haven’t seen any mobile VR solutions here is an example of the lowest budget version I could find which illustrates the main components required:</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/01/cardboard.jpg"><img title="cardboard" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; margin-left: 0px; display: inline; border-top-width: 0px; margin-right: 0px" border="0" alt="cardboard" src="http://peted.azurewebsites.net/wp-content/uploads/2015/01/cardboard_thumb.jpg" width="879" align="left" height="496"></a> </p> <p>The phone slides in behind the lenses at the back.</p> <p>The basic idea behind how this works is that each eye receives a 2d image of a 3d perspective view which are rendered offset from each other. The brain assembles these projections from the retina giving the illusion of depth.</p> <p>The lenses allow a much wider field of vision but they also distort the image. These factors result in the need to render your 3D scene twice, side-by-side each from a slightly different viewpoints and also to render it in such a way as to ‘undo’ the lens distortion and keep any straight lines looking straight.&nbsp; </p> <p>&nbsp;</p> <p>I ordered this functioning cardboard headset at a cost of £2; unfortunately, I can’t fit my Lumia 930 inside it but it illustrates the parts involved.&nbsp;&nbsp; </p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/01/cardboardunfolded.jpg"><img title="cardboard unfolded" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; margin-left: 0px; display: inline; border-top-width: 0px; margin-right: 0px" border="0" alt="cardboard unfolded" src="http://peted.azurewebsites.net/wp-content/uploads/2015/01/cardboardunfolded_thumb.jpg" width="873" align="left" height="493"></a> </p> <p></p> <p>Since this won’t accommodate my phone for subsequent posts I will be using a prototype of the <strong>ViSR</strong> headset see their Kickstarter here <a title="https://www.kickstarter.com/projects/1122924030/visr-virtual-reality/description" href="https://www.kickstarter.com/projects/1122924030/visr-virtual-reality/description">https://www.kickstarter.com/projects/1122924030/visr-virtual-reality/description</a>.&nbsp; This is a much better built version made of laminated corrugate which feels really solid and is expected to be sold at a £15 price point. If you’re into mobile VR go to the Kickstarter and pledge – there are even pre-release developer edition headsets available. The <strong>ViSR</strong> developers are working on a Unity package which will be available for this headset which will enable devs to get up and running quickly.</p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/01/VISRsmall.png"><img title="VISRsmall" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="VISRsmall" src="http://peted.azurewebsites.net/wp-content/uploads/2015/01/VISRsmall_thumb.png" width="868" height="490"></a>&nbsp;&nbsp; </p> <h5>Gyroscope</h5> <p>Another aspect of mobile VR is that when you have your headset on and you rotate your head the scene view should orient appropriately to give you a sense that you are in the scene and looking around. This is what I will focus on in this post to get the ball rolling and I’m going to try to keep it as simple as possible. Most mid-high end smart phones come equipped with a gyroscope and that is what I’m going to use to achieve the head tracking. We can get readings from the gyroscope in a Unity script which will allow us to orient the view appropriately.</p> <div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:d47953e0-8e33-4e84-9c1d-51119443555c" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"> <div class="le-pavsc-container"> <div style="background: #ddd; overflow: auto"> <ol start="1" style="background: #000000; margin: 0 0 0 2.5em; padding: 0 0 0 5px;"> <li><span style="background:#1e1e1e;color:#569cd6">public</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">class</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">HeadTrack</span><span style="background:#1e1e1e;color:#dcdcdc"> : </span><span style="background:#1e1e1e;color:#4ec9b0">MonoBehaviour</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">private</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">bool</span><span style="background:#1e1e1e;color:#dcdcdc"> gyroBool;</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">private</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Gyroscope</span><span style="background:#1e1e1e;color:#dcdcdc"> gyro;</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">private</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Quaternion</span><span style="background:#1e1e1e;color:#dcdcdc"> rotFix;</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">private</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Vector3</span><span style="background:#1e1e1e;color:#dcdcdc"> initial </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">new</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Vector3</span><span style="background:#1e1e1e;color:#dcdcdc">(</span><span style="background:#1e1e1e;color:#b5cea8">90</span><span style="background:#1e1e1e;color:#dcdcdc">, </span><span style="background:#1e1e1e;color:#b5cea8">180</span><span style="background:#1e1e1e;color:#dcdcdc">, </span><span style="background:#1e1e1e;color:#b5cea8">0</span><span style="background:#1e1e1e;color:#dcdcdc">);</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc"></span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#57a64a">// Use this for initialization</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">void</span><span style="background:#1e1e1e;color:#dcdcdc"> Start()</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">Screen</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">orientation </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b8d7a3">ScreenOrientation</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">LandscapeLeft;</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">Screen</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">sleepTimeout </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">SleepTimeout</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">NeverSleep;</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">gyroBool </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">SystemInfo</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">supportsGyroscope;</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">Debug</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Log(</span><span style="background:#1e1e1e;color:#d69d85">&quot;gyro bool = &quot;</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#b4b4b4">+</span><span style="background:#1e1e1e;color:#dcdcdc"> gyroBool</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">ToString());</span></li> <li>&nbsp;</li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (gyroBool)</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc">gyro </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Input</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">gyro;</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">gyro</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">enabled </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">true</span><span style="background:#1e1e1e;color:#dcdcdc">;</span></li> <li class="le-pavsc-even">&nbsp;</li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">rotFix </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">new</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#4ec9b0">Quaternion</span><span style="background:#1e1e1e;color:#dcdcdc">(</span><span style="background:#1e1e1e;color:#b5cea8">0</span><span style="background:#1e1e1e;color:#dcdcdc">, </span><span style="background:#1e1e1e;color:#b5cea8">0</span><span style="background:#1e1e1e;color:#dcdcdc">, </span><span style="background:#1e1e1e;color:#b5cea8">0.7071f</span><span style="background:#1e1e1e;color:#dcdcdc">, </span><span style="background:#1e1e1e;color:#b5cea8">0.7071f</span><span style="background:#1e1e1e;color:#dcdcdc">);</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">else</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">Debug</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Log(</span><span style="background:#1e1e1e;color:#d69d85">&quot;No Gyro Support&quot;</span><span style="background:#1e1e1e;color:#dcdcdc">);</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">&nbsp;</li> <li>    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#57a64a">// Update is called once per frame</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">void</span><span style="background:#1e1e1e;color:#dcdcdc"> Update()</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (gyroBool)</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">var</span><span style="background:#1e1e1e;color:#dcdcdc"> camRot </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> gyro</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">attitude </span><span style="background:#1e1e1e;color:#b4b4b4">*</span><span style="background:#1e1e1e;color:#dcdcdc"> rotFix;</span></li> <li>            <span style="background:#1e1e1e;color:#dcdcdc">transform</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">eulerAngles </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> initial;</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc">transform</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">localRotation </span><span style="background:#1e1e1e;color:#b4b4b4">*=</span><span style="background:#1e1e1e;color:#dcdcdc"> camRot;</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li><span style="background:#1e1e1e;color:#dcdcdc">}</span></li> </ol> </div> </div> </div> <p>Note that the coordinate systems need to be aligned between Unity and the data coming from the phone. So simply taking this script and attaching it to the Main Camera in a Unity scene, building it for Windows Phone 8.1</p> <blockquote> <p>I added the Visual Studio Tools as I’m more comfortable editing and debugging in Visual Studio. You can download the tools from here <a href="https://visualstudiogallery.msdn.microsoft.com/20b80b8c-659b-45ef-96c1-437828fe7cf2">https://visualstudiogallery.msdn.microsoft.com/20b80b8c-659b-45ef-96c1-437828fe7cf2</a>. </p></blockquote> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/01/image.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" border="0" alt="image" src="http://peted.azurewebsites.net/wp-content/uploads/2015/01/image_thumb.png" width="601" height="700"></a> </p> <p>For the Unity scene in the video I created a terrain object, added some hills and added a skybox to the camera with a nice sunny day texture. </p> <blockquote> <p>Building this unity scene into a windows app can be achieved as follows:</p> <p>- Edit the unity build settings dialog to choose the platform Windows Store or Windows Phone 8 (Windows Store will give the choice between 8.0, 8.1, Phone 8.1 or Universal 8.1). I used Windows Store + Phone 8.1</p> <p>- Choose ‘Build’ and select a location for the output solution</p> <p>- Open the generated solution in Visual Studio</p> <p>- Debug from Visual Studio </p></blockquote> <p>Running the resulting app will show using orientation in an app in a pretty simple, but effective way.</p><iframe height="315" src="//www.youtube.com/embed/_YwaH4pBcws" frameborder="0" width="420" allowfullscreen></iframe> <p>&nbsp;</p> <h5>First Person Camera</h5> <p>It would be nice to use this to drive a first person camera so that we can use a different input method to allow the camera to move forward and backwards as at the moment the camera is stuck in one spot. Unity has a package to help here:</p> <p>Use File &gt; Assets &gt; Import Package and choose Character Controller and import everything into your project. Now, under Standard Assets &gt; Character Controllers you will see two character controllers; one for third person and one for first person. </p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/01/CharContollers.png"><img title="CharContollers" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="CharContollers" src="http://peted.azurewebsites.net/wp-content/uploads/2015/01/CharContollers_thumb.png" width="459" height="203"></a> </p> <p>You can drag the First Person Controller into your scene and delete the existing Main Camera as there is one included with the Character Controller. You will also need to position your character controller above the terrain floor otherwise it will just keep falling; it’s a rigid body so reacts accordingly. </p> <p><a href="http://peted.azurewebsites.net/wp-content/uploads/2015/01/fpscontroller.png"><img title="fpscontroller" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="fpscontroller" src="http://peted.azurewebsites.net/wp-content/uploads/2015/01/fpscontroller_thumb.png" width="453" height="296"></a> </p> <p>Out of the box you can use mouse to orbit and keyboard to navigate the camera forwards, backwards and to jump. We’re going to replace the input with our head tracking and add some buttons to ‘walk’ forwards and backwards. So now, as before drag the HeadTrack.cs script onto the new Camera. This gets us back to the functionality we had before but we can now wire up some of the other actions. I’ll just stick to forwards and backwards for now.</p> <blockquote> <p>Before this I noticed that some of the scripts associated with the FP Controller are javascript so I found these equivalent scripts <a title="http://forum.unity3d.com/threads/charactermotor-fpsinputcontroller-platforminputcontroller-in-c.64378/" href="http://forum.unity3d.com/threads/charactermotor-fpsinputcontroller-platforminputcontroller-in-c.64378/">http://forum.unity3d.com/threads/charactermotor-fpsinputcontroller-platforminputcontroller-in-c.64378/</a> and used those as a base.(I wanted to share values between scripts and the javascript and c# scripts were being compiled in an order that meant I couldn’t do this easily).&nbsp; </p> <p></p> <p></p></blockquote> <p>I then provided the direction movement vectors to the FPSInputController.cs script using some static variables which I marshalled to the unity render thread from the xaml environment where I altered those values in response to button presses. (Note that this was done for convenience).</p> <p>I added this xaml into the content of the SwapChainPanel</p> <div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:ec83c55f-1077-4b0e-9a76-dae94c26e7fa" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"> <div class="le-pavsc-container"> <div style="background: #ddd; overflow: auto"> <ol start="1" style="background: #000000; margin: 0 0 0 2.5em; padding: 0 0 0 5px;"> <li><span style="background:#1e1e1e;color:#ababab"></span><span style="background:#1e1e1e;color:#808080">&lt;</span><span style="background:#1e1e1e;color:#e6e6e6">Grid</span><span style="background:#1e1e1e;color:#808080">&gt;</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#ababab"></span><span style="background:#1e1e1e;color:#808080">&lt;</span><span style="background:#1e1e1e;color:#e6e6e6">Grid.RowDefinitions</span><span style="background:#1e1e1e;color:#808080">&gt;</span></li> <li>        <span style="background:#1e1e1e;color:#ababab"></span><span style="background:#1e1e1e;color:#808080">&lt;</span><span style="background:#1e1e1e;color:#e6e6e6">RowDefinition</span><span style="background:#1e1e1e;color:#808080">&gt;&lt;/</span><span style="background:#1e1e1e;color:#e6e6e6">RowDefinition</span><span style="background:#1e1e1e;color:#808080">&gt;</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#ababab"></span><span style="background:#1e1e1e;color:#808080">&lt;</span><span style="background:#1e1e1e;color:#e6e6e6">RowDefinition</span><span style="background:#1e1e1e;color:#92caf4"> Height</span><span style="background:#1e1e1e;color:#808080">=</span><span style="background:#1e1e1e;color:#569cd6">&quot;Auto&quot;</span><span style="background:#1e1e1e;color:#808080">&gt;&lt;/</span><span style="background:#1e1e1e;color:#e6e6e6">RowDefinition</span><span style="background:#1e1e1e;color:#808080">&gt;</span></li> <li>    <span style="background:#1e1e1e;color:#ababab"></span><span style="background:#1e1e1e;color:#808080">&lt;/</span><span style="background:#1e1e1e;color:#e6e6e6">Grid.RowDefinitions</span><span style="background:#1e1e1e;color:#808080">&gt;</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#ababab"></span><span style="background:#1e1e1e;color:#808080">&lt;</span><span style="background:#1e1e1e;color:#e6e6e6">Grid</span><span style="background:#1e1e1e;color:#92caf4"> Grid.Row</span><span style="background:#1e1e1e;color:#808080">=</span><span style="background:#1e1e1e;color:#569cd6">&quot;1&quot;</span><span style="background:#1e1e1e;color:#808080">&gt;</span></li> <li>        <span style="background:#1e1e1e;color:#ababab"></span><span style="background:#1e1e1e;color:#808080">&lt;</span><span style="background:#1e1e1e;color:#e6e6e6">Button</span><span style="background:#1e1e1e;color:#92caf4"> IsHoldingEnabled</span><span style="background:#1e1e1e;color:#808080">=</span><span style="background:#1e1e1e;color:#569cd6">&quot;True&quot;</span></li> <li class="le-pavsc-even">               <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#92caf4"> Holding</span><span style="background:#1e1e1e;color:#808080">=</span><span style="background:#1e1e1e;color:#569cd6">&quot;ForwardHolding&quot;</span><span style="background:#1e1e1e;color:#808080">&gt;</span><span style="background:#1e1e1e;color:#ababab">forward</span><span style="background:#1e1e1e;color:#808080">&lt;/</span><span style="background:#1e1e1e;color:#e6e6e6">Button</span><span style="background:#1e1e1e;color:#808080">&gt;</span></li> <li>        <span style="background:#1e1e1e;color:#ababab"></span><span style="background:#1e1e1e;color:#808080">&lt;</span><span style="background:#1e1e1e;color:#e6e6e6">Button</span><span style="background:#1e1e1e;color:#92caf4"> IsHoldingEnabled</span><span style="background:#1e1e1e;color:#808080">=</span><span style="background:#1e1e1e;color:#569cd6">&quot;True&quot;</span></li> <li class="le-pavsc-even">               <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#92caf4"> Holding</span><span style="background:#1e1e1e;color:#808080">=</span><span style="background:#1e1e1e;color:#569cd6">&quot;BackwardHolding&quot;</span></li> <li>               <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#92caf4"> HorizontalAlignment</span><span style="background:#1e1e1e;color:#808080">=</span><span style="background:#1e1e1e;color:#569cd6">&quot;Right&quot;</span><span style="background:#1e1e1e;color:#808080">&gt;</span><span style="background:#1e1e1e;color:#ababab">backward</span><span style="background:#1e1e1e;color:#808080">&lt;/</span><span style="background:#1e1e1e;color:#e6e6e6">Button</span><span style="background:#1e1e1e;color:#808080">&gt;</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#ababab"></span><span style="background:#1e1e1e;color:#808080">&lt;/</span><span style="background:#1e1e1e;color:#e6e6e6">Grid</span><span style="background:#1e1e1e;color:#808080">&gt;</span></li> <li><span style="background:#1e1e1e;color:#ababab"></span><span style="background:#1e1e1e;color:#808080">&lt;/</span><span style="background:#1e1e1e;color:#e6e6e6">Grid</span><span style="background:#1e1e1e;color:#808080">&gt;</span></li> </ol> </div> </div> </div> <p>These are the button event handlers:</p> <div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:43101e5b-1500-40bd-a94b-900972773f1d" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"> <div class="le-pavsc-container"> <div style="background: #ddd; overflow: auto"> <ol start="1" style="background: #000000; margin: 0 0 0 2.5em; padding: 0 0 0 5px;"> <li><span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">private</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">void</span><span style="background:#1e1e1e;color:#dcdcdc"> BackwardHolding(</span><span style="background:#1e1e1e;color:#569cd6">object</span><span style="background:#1e1e1e;color:#dcdcdc"> sender, </span><span style="background:#1e1e1e;color:#4ec9b0">HoldingRoutedEventArgs</span><span style="background:#1e1e1e;color:#dcdcdc"> e)</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">MoveVertical(</span><span style="background:#1e1e1e;color:#b4b4b4">-</span><span style="background:#1e1e1e;color:#b5cea8">1</span><span style="background:#1e1e1e;color:#dcdcdc">);</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>&nbsp;</li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">private</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">static</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">void</span><span style="background:#1e1e1e;color:#dcdcdc"> MoveVertical(</span><span style="background:#1e1e1e;color:#569cd6">int</span><span style="background:#1e1e1e;color:#dcdcdc"> val)</span></li> <li><span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">if</span><span style="background:#1e1e1e;color:#dcdcdc"> (UnityPlayer</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#4ec9b0">AppCallbacks</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Instance</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">IsInitialized())</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">UnityPlayer</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#4ec9b0">AppCallbacks</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">Instance</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">InvokeOnAppThread(</span><span style="background:#1e1e1e;color:#569cd6">new</span><span style="background:#1e1e1e;color:#dcdcdc"> UnityPlayer</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#4ec9b0">AppCallbackItem</span><span style="background:#1e1e1e;color:#dcdcdc">(() </span><span style="background:#1e1e1e;color:#b4b4b4">=&gt;</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">            <span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#4ec9b0">MobileInput</span><span style="background:#1e1e1e;color:#b4b4b4">.</span><span style="background:#1e1e1e;color:#dcdcdc">VerticalAxis </span><span style="background:#1e1e1e;color:#b4b4b4">=</span><span style="background:#1e1e1e;color:#dcdcdc"> val;</span></li> <li>        <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">        <span style="background:#1e1e1e;color:#dcdcdc">), </span><span style="background:#1e1e1e;color:#569cd6">false</span><span style="background:#1e1e1e;color:#dcdcdc">);</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li>&nbsp;</li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">private</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">void</span><span style="background:#1e1e1e;color:#dcdcdc"> ForwardHolding(</span><span style="background:#1e1e1e;color:#569cd6">object</span><span style="background:#1e1e1e;color:#dcdcdc"> sender, </span><span style="background:#1e1e1e;color:#4ec9b0">HoldingRoutedEventArgs</span><span style="background:#1e1e1e;color:#dcdcdc"> e)</span></li> <li><span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li class="le-pavsc-even">    <span style="background:#1e1e1e;color:#dcdcdc">MoveVertical(</span><span style="background:#1e1e1e;color:#b5cea8">1</span><span style="background:#1e1e1e;color:#dcdcdc">);</span></li> <li><span style="background:#1e1e1e;color:#dcdcdc">}</span></li> <li class="le-pavsc-even">&nbsp;</li> <li><span style="background:#1e1e1e;color:#dcdcdc"></span><span style="background:#1e1e1e;color:#569cd6">private</span><span style="background:#1e1e1e;color:#dcdcdc"> </span><span style="background:#1e1e1e;color:#569cd6">void</span><span style="background:#1e1e1e;color:#dcdcdc"> Button_PointerReleased(</span><span style="background:#1e1e1e;color:#569cd6">object</span><span style="background:#1e1e1e;color:#dcdcdc"> sender, </span><span style="background:#1e1e1e;color:#4ec9b0">PointerRoutedEventArgs</span><span style="background:#1e1e1e;color:#dcdcdc"> e)</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">{</span></li> <li>    <span style="background:#1e1e1e;color:#dcdcdc">MoveVertical(</span><span style="background:#1e1e1e;color:#b5cea8">0</span><span style="background:#1e1e1e;color:#dcdcdc">);</span></li> <li class="le-pavsc-even"><span style="background:#1e1e1e;color:#dcdcdc">}</span></li> </ol> </div> </div> </div> <p>(On reflection this should just marshal over when the user presses and releases to avoid queuing up too many calls).</p> <p>The sample Unity project is on Github here <a title="https://github.com/peted70/head-tracking-unity" href="https://github.com/peted70/head-tracking-unity">https://github.com/peted70/head-tracking-unity</a></p> <p>&nbsp;</p> <p>In the next post I will look at stereoscopic rendering and removing the lens distortion effect so that I can run the demo inside my <strong>ViSR</strong>.</p>
